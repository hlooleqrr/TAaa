<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <title>Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ© - ØªØ±Ø´ÙŠØ­ Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù†Ø³Ø¨</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        :root {
            --primary: #1b4f72;
            --primary-soft: #d6eaf8;
            --accent: #f1c40f;
            --danger: #c0392b;
            --success: #1e8449;
            --bg: #f4f6fb;
            --card: #ffffff;
            --radius-lg: 18px;
            --radius-md: 12px;
            --shadow-soft: 0 10px 30px rgba(0,0,0,0.06);
        }
        * { box-sizing: border-box; }
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Tajawal", "Segoe UI", sans-serif;
            background: radial-gradient(circle at top left, #e8f4ff, #f9fbff 55%, #eef2ff);
            color: #222;
        }
        header {
            position: sticky;
            top: 0;
            z-index: 999;
            backdrop-filter: blur(10px);
            background: linear-gradient(90deg, rgba(27,79,114,0.98), rgba(40,116,166,0.97));
            color: #fff;
            padding: 10px 16px 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.12);
        }
        .header-inner {
            max-width: 1000px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }
        .brand {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .logo-circle {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            border: 2px solid var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 19px;
            background: rgba(0,0,0,0.15);
        }
        header h1 {
            margin: 0;
            font-size: 17px;
        }
        header p {
            margin: 2px 0 0;
            font-size: 13px;
            opacity: 0.94;
        }
        .header-badge {
            font-size: 11px;
            padding: 5px 10px;
            border-radius: 999px;
            background: rgba(241,196,15,0.15);
            border: 1px solid rgba(241,196,15,0.6);
            color: #fdfefe;
            white-space: nowrap;
        }
        main {
            max-width: 1000px;
            margin: 0 auto;
            padding: 18px 16px 80px;
        }
        .layout {
            display: grid;
            grid-template-columns: minmax(0, 3fr) minmax(0, 2fr);
            gap: 18px;
        }
        @media (max-width: 800px) {
            .layout { grid-template-columns: 1fr; }
        }
        .card {
            background: var(--card);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-soft);
            padding: 16px 16px 18px;
        }
        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
            gap: 8px;
        }
        .card-header h2 {
            margin: 0;
            font-size: 17px;
            color: var(--primary);
        }
        .card-header span {
            font-size: 12px;
            color: #566573;
        }
        .steps {
            display: flex;
            gap: 6px;
            margin-bottom: 14px;
            flex-wrap: wrap;
        }
        .step-pill {
            padding: 6px 10px;
            border-radius: 999px;
            font-size: 11px;
            background: #eaecee;
            color: #566573;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .step-pill.active {
            background: var(--primary-soft);
            color: var(--primary);
            font-weight: 600;
        }
        .step-pill .dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            background: #d5dbdb;
        }
        .step-pill.active .dot {
            background: var(--primary);
            color: #fff;
        }
        .field { margin-bottom: 12px; }
        .field label {
            display: block;
            margin-bottom: 4px;
            font-size: 14px;
            font-weight: 600;
            color: #273746;
        }
        .field small {
            font-size: 11px;
            color: #7d8597;
        }
        select, input[type="number"], input[type="password"], input[type="text"], textarea {
            width: 100%;
            padding: 9px 10px;
            border-radius: var(--radius-md);
            border: 1px solid #cfd8dc;
            background: #fdfefe;
            font-size: 14px;
            outline: none;
        }
        textarea { min-height: 50px; resize: vertical; }
        select:focus, input:focus, textarea:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(27,79,114,0.08);
        }
        .actions-row {
            margin-top: 12px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: flex-start;
        }
        .btn {
            border-radius: 999px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            padding: 10px 18px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #1b4f72, #2471a3);
            color: #fff;
            font-weight: 600;
        }
        .btn-outline {
            background: #f8f9f9;
            color: #34495e;
            border: 1px solid #d5d8dc;
        }
        .btn-sm {
            padding: 6px 10px;
            font-size: 12px;
        }
        .result-main-card {
            border-radius: var(--radius-lg);
            border: 1px solid #d6eaf8;
            background: linear-gradient(145deg, #eaf2f8, #ffffff);
            padding: 14px 14px 12px;
            margin-bottom: 12px;
        }
        .result-main-top {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .bank-logo {
            width: 54px;
            height: 54px;
            border-radius: 18px;
            background: var(--primary);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
            font-weight: 700;
        }
        .result-main-top h3 {
            margin: 0 0 3px;
            font-size: 16px;
            color: #1b4f72;
        }
        .result-main-top p {
            margin: 1px 0;
            font-size: 13px;
            color: #455a64;
        }
        .badge-pill {
            display: inline-flex;
            align-items: center;
            padding: 3px 8px;
            border-radius: 999px;
            font-size: 11px;
            background: rgba(30,132,73,0.08);
            color: var(--success);
            border: 1px solid rgba(30,132,73,0.4);
            margin-top: 4px;
        }
        .banks-list { margin-top: 10px; font-size: 13px; }
        .banks-list table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        .banks-list th,
        .banks-list td {
            padding: 6px 4px;
            border-bottom: 1px solid #ecf0f1;
            text-align: right;
        }
        .banks-list th {
            font-weight: 600;
            color: #34495e;
            background: #f7f9fb;
        }
        .banks-list tr:nth-child(even) td {
            background: #fbfcfe;
        }
        .rate-source { font-size: 11px; color: #7d8597; }
        .rate-note { font-size: 11px; color: #8e44ad; }
        .disclaimer {
            margin-top: 10px;
            padding: 8px 10px;
            border-radius: var(--radius-md);
            font-size: 11px;
            color: var(--danger);
            background: #fdf2f2;
            display: flex;
            gap: 6px;
            align-items: flex-start;
        }
        .disclaimer span.icon {
            font-size: 16px;
            margin-top: 1px;
        }
        .screenshot-note {
            margin-top: 9px;
            font-size: 13px;
            color: #f39c12;
            font-weight: 600;
        }
        .screenshot-note a {
            color: #d68910;
            text-decoration: underline;
        }
        .muted { font-size: 12px; color: #7d8597; }
        .center { text-align: center; }
        .empty-state {
            text-align: center;
            padding: 16px 6px 6px;
            font-size: 13px;
            color: #7d8597;
        }
        footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #1b2631;
            color: #f0f3f4;
            font-size: 11px;
            padding: 6px 10px 4px;
            text-align: center;
        }
        footer span { display: block; }
        footer a {
            color: var(--accent);
            text-decoration: none;
        }
        .admin-msg { margin-top: 8px; font-size: 12px; }
        .admin-msg.error { color: var(--danger); }
        .admin-msg.success { color: var(--success); }
        .admin-rules {
            margin-top: 14px;
            max-height: 210px;
            overflow-y: auto;
            border-top: 1px dashed #d5d8dc;
            padding-top: 8px;
        }
        .rule-row {
            font-size: 11px;
            padding: 6px 4px;
            border-radius: 8px;
            background: #f9fbff;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 6px;
            margin-bottom: 4px;
        }
        .rule-row button {
            border-radius: 999px;
            border: none;
            background: #fdecea;
            color: #c0392b;
            font-size: 10px;
            padding: 3px 7px;
            cursor: pointer;
        }
        .admin-entry {
            margin-top: 12px;
            border-top: 1px dashed #d5d8dc;
            padding-top: 8px;
            text-align: left;
        }
        .admin-entry .btn {
            font-size: 11px;
            padding: 6px 10px;
        }
    </style>
</head>
<body>

<header>
    <div class="header-inner">
        <div class="brand">
            <div class="logo-circle">Ø³</div>
            <div>
                <h1>Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ©</h1>
                <p>Ù…Ù†ØµÙ‘Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù„ØªØ±Ø´ÙŠØ­ Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù†Ø³Ø¨ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ ÙˆØ´Ø±ÙŠØ­Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„</p>
            </div>
        </div>
        <div class="header-badge">
            Ù…Ø±Ø¬Ø¹ Ù…ÙˆØ«ÙˆÙ‚ Ù„Ù…Ø³ØªØ´Ø§Ø±ÙŠ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ ÙˆÙ…ÙˆØ¸ÙÙŠ Ø§Ù„Ø¨Ù†ÙˆÙƒ
        </div>
    </div>
</header>

<main class="layout">

    <!-- Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
    <section class="card">
        <div class="card-header">
            <h2>Ø®Ø·ÙˆØ§Øª ØªØ±Ø´ÙŠØ­ Ø§Ù„Ø¨Ù†Ùƒ Ù„Ù„Ø¹Ù…ÙŠÙ„</h2>
            <span>Ø§Ù…Ù„Ø£ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© Ø«Ù… Ø§Ø¶ØºØ· "ØªØ±Ø´ÙŠØ­ Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù†Ø³Ø¨"</span>
        </div>

        <div class="steps">
            <div class="step-pill active" id="step-pill-1">
                <span class="dot">1</span> Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„
            </div>
            <div class="step-pill" id="step-pill-2">
                <span class="dot">2</span> Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù…Ù„ ÙˆØ§Ù„Ø¯Ø¹Ù…
            </div>
            <div class="step-pill" id="step-pill-3">
                <span class="dot">3</span> Ø´Ø±ÙŠØ­Ø© Ø§Ù„Ø±Ø§ØªØ¨ ÙˆØ§Ù„Ù…Ø¯Ø©
            </div>
        </div>

        <div id="client-form">
            <!-- Ø§Ù„Ø®Ø·ÙˆØ© 1 -->
            <div id="step-1">
                <div class="field">
                    <label for="financeType">Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</label>
                    <select id="financeType">
                        <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„...</option>
                        <option value="mortgage">ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ</option>
                        <option value="mortgage-buyout">Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø¹Ù‚Ø§Ø±ÙŠ</option>
                        <option value="personal">ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ</option>
                        <option value="personal-buyout">Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø´Ø®ØµÙŠ</option>
                        <option value="consumer">ØªÙ…ÙˆÙŠÙ„ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ</option>
                        <option value="car-lease">ØªÙ…ÙˆÙŠÙ„ ØªØ£Ø¬ÙŠØ± Ù…Ø±ÙƒØ¨Ø§Øª</option>
                    </select>
                </div>
                <div class="actions-row">
                    <button class="btn btn-primary" onclick="goToStep(2)">Ø§Ù„ØªØ§Ù„ÙŠ</button>
                </div>
            </div>

            <!-- Ø§Ù„Ø®Ø·ÙˆØ© 2 -->
            <div id="step-2" style="display:none;">
                <div class="field">
                    <label for="employeeType">Ù†ÙˆØ¹ Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù…Ù„</label>
                    <select id="employeeType">
                        <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù…Ù„...</option>
                        <option value="civil">Ù…Ø¯Ù†ÙŠ / Ø­ÙƒÙˆÙ…ÙŠ</option>
                        <option value="military">Ø¹Ø³ÙƒØ±ÙŠ</option>
                        <option value="semi-gov">Ø´Ø¨Ù‡ Ø­ÙƒÙˆÙ…ÙŠ</option>
                        <option value="private">Ù‚Ø·Ø§Ø¹ Ø®Ø§Øµ</option>
                    </select>
                </div>

                <div class="field" id="supportField" style="display:none;">
                    <label for="supportType">Ù‡Ù„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ø¯Ø¹ÙˆÙ…ØŸ</label>
                    <select id="supportType">
                        <option value="">Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø¹Ù…...</option>
                        <option value="supported">ØªÙ…ÙˆÙŠÙ„ Ù…Ø¯Ø¹ÙˆÙ…</option>
                        <option value="unsupported">ØªÙ…ÙˆÙŠÙ„ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…</option>
                    </select>
                    <small>ÙŠØ·Ø¨Ù‘Ù‚ Ø¹Ø§Ø¯Ø©Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ ÙˆØ¨Ø±Ø§Ù…Ø¬ Ø³ÙƒÙ†ÙŠ.</small>
                </div>

                <div class="field" id="itizezField" style="display:none;">
                    <label for="itizezEligible">Ù‡Ù„ Ø£Ù†Øª Ù…Ø¤Ù‡Ù„ Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© Ø§Ø¹ØªØ²Ø§Ø² (ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¯ÙØ§Ø¹)ØŸ</label>
                    <select id="itizezEligible">
                        <option value="">Ø§Ø®ØªØ±...</option>
                        <option value="yes">Ù†Ø¹Ù…ØŒ Ù…Ø¤Ù‡Ù„ Ø§Ø¹ØªØ²Ø§Ø² ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¯ÙØ§Ø¹</option>
                        <option value="no">Ù„Ø§ØŒ Ù„Ø³Øª Ø¶Ù…Ù† Ø§Ø¹ØªØ²Ø§Ø²</option>
                    </select>
                </div>

                <div class="actions-row">
                    <button class="btn btn-outline btn-sm" onclick="goToStep(1)">Ø±Ø¬ÙˆØ¹</button>
                    <button class="btn btn-primary" onclick="goToStep(3)">Ø§Ù„ØªØ§Ù„ÙŠ</button>
                </div>
            </div>

            <!-- Ø§Ù„Ø®Ø·ÙˆØ© 3 -->
            <div id="step-3" style="display:none;">
                <div class="field">
                    <label for="salarySegment">Ø´Ø±ÙŠØ­Ø© Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø´Ù‡Ø±ÙŠ</label>
                    <select id="salarySegment"></select>
                    <small id="salaryHint">Ø´Ø±Ø§Ø¦Ø­ Ø§Ù„Ø±Ø§ØªØ¨ ÙŠØªÙ… Ø¶Ø¨Ø·Ù‡Ø§ Ù…Ù† Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„.</small>
                </div>

                <div class="field">
                    <label for="months">Ø¹Ø¯Ø¯ Ø£Ø´Ù‡Ø± Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</label>
                    <select id="months"></select>
                    <small id="monthsHint">ÙŠØªØºÙŠÙ‘Ø± Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„.</small>
                </div>

                <div class="actions-row">
                    <button class="btn btn-outline btn-sm" onclick="goToStep(2)">Ø±Ø¬ÙˆØ¹</button>
                    <button class="btn btn-primary" onclick="calculateRecommendationClient()">
                        ØªØ±Ø´ÙŠØ­ Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù†Ø³Ø¨
                    </button>
                </div>
            </div>
        </div>

        <!-- Ø²Ø± Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ -->
        <div class="admin-entry">
            <button class="btn btn-outline" onclick="showAdminSection()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</button>
        </div>
    </section>

    <!-- Ø¬Ù‡Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙˆÙ„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ -->
    <section class="card">
        <div class="card-header">
            <h2>Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ±Ø´ÙŠØ­</h2>
            <span>ØªØ­Ø¯ÙŠØ« Ø¢Ù„ÙŠ Ù…Ø¨Ù†ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù‘ÙØ³ÙØ¨ Ø§Ù„Ù…Ø¯Ø®Ù„Ø© Ù…Ù† Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</span>
        </div>

        <div id="resultArea" class="empty-state">
            Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† Ø«Ù… Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø±<br>
            <strong>"ØªØ±Ø´ÙŠØ­ Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù†Ø³Ø¨"</strong> Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù‡Ù†Ø§.
        </div>

        <hr style="margin:16px 0 12px; border:none; border-top:1px dashed #d5d8dc;">

        <div id="admin-section-wrapper" style="display:none;">
            <div class="card-header" style="margin-bottom:6px;">
                <h2 style="font-size:15px;">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ (ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‘ÙØ³ÙØ¨ ÙˆØ§Ù„Ø¹Ø±ÙˆØ¶)</h2>
                <span>Ù…Ø®ØµØµØ© Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† ÙÙ‚Ø·</span>
            </div>

            <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ -->
            <div id="admin-login">
                <div class="field">
                    <label for="adminPassword">Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„</label>
                    <input type="password" id="adminPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
                    <small>Ù…Ø®ØµØµ Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† ÙÙ‚Ø·. Ø£ÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… ØºÙŠØ± Ù…ØµØ±Ø­ Ø¨Ù‡ ÙŠØ¹Ø±Ø¶Ùƒ Ù„Ù„Ù…Ø³Ø§Ø¡Ù„Ø©.</small>
                </div>
                <div class="actions-row">
                    <button class="btn btn-primary btn-sm" onclick="adminLogin()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</button>
                </div>
                <div id="adminLoginMsg" class="admin-msg"></div>
            </div>

            <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
            <div id="admin-panel" style="display:none; margin-top:10px;">
                <div class="field">
                    <label for="adminBank">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±Ø§Ø¯ ØªØ­Ø¯ÙŠØ« Ù†Ø³Ø¨Ù‡</label>
                    <select id="adminBank" onchange="renderAdminRules()"></select>
                </div>

                <div class="field">
                    <label for="adminFinanceType">Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„</label>
                    <select id="adminFinanceType" onchange="adminFinanceTypeChanged()">
                        <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„...</option>
                        <option value="mortgage">ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ</option>
                        <option value="mortgage-buyout">Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø¹Ù‚Ø§Ø±ÙŠ</option>
                        <option value="personal">ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ</option>
                        <option value="personal-buyout">Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø´Ø®ØµÙŠ</option>
                        <option value="consumer">ØªÙ…ÙˆÙŠÙ„ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ</option>
                        <option value="car-lease">ØªÙ…ÙˆÙŠÙ„ ØªØ£Ø¬ÙŠØ± Ù…Ø±ÙƒØ¨Ø§Øª</option>
                    </select>
                </div>

                <div class="field" id="adminSupportWrapper" style="display:none;">
                    <label for="adminSupportType">Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø¹Ù… (Ù„Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ)</label>
                    <select id="adminSupportType" onchange="adminEmployeeChanged()">
                        <option value="">Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø¹Ù…...</option>
                        <option value="supported">ØªÙ…ÙˆÙŠÙ„ Ù…Ø¯Ø¹ÙˆÙ…</option>
                        <option value="unsupported">ØªÙ…ÙˆÙŠÙ„ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…</option>
                    </select>
                </div>

                <div class="field">
                    <label for="adminEmployeeType">Ù†ÙˆØ¹ Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù…Ù„</label>
                    <select id="adminEmployeeType" onchange="adminEmployeeChanged()">
                        <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù…Ù„...</option>
                        <option value="civil">Ù…Ø¯Ù†ÙŠ / Ø­ÙƒÙˆÙ…ÙŠ</option>
                        <option value="military">Ø¹Ø³ÙƒØ±ÙŠ</option>
                        <option value="semi-gov">Ø´Ø¨Ù‡ Ø­ÙƒÙˆÙ…ÙŠ</option>
                        <option value="private">Ù‚Ø·Ø§Ø¹ Ø®Ø§Øµ</option>
                    </select>
                </div>

                <div class="field" id="adminItizezWrapper" style="display:none;">
                    <label for="adminItizez">Ù‡Ù„ Ø§Ù„Ù†Ø³Ø¨Ø© ØªØ®Øµ Ø¹Ù…Ù„Ø§Ø¡ Ø§Ø¹ØªØ²Ø§Ø² (ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¯ÙØ§Ø¹)ØŸ</label>
                    <select id="adminItizez">
                        <option value="">Ø§Ø®ØªØ±...</option>
                        <option value="yes">Ù†Ø¹Ù… - Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ø¹ØªØ²Ø§Ø² ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¯ÙØ§Ø¹</option>
                        <option value="no">Ù„Ø§ - Ø¹Ù…Ù„Ø§Ø¡ Ø¹Ø³ÙƒØ±ÙŠÙŠÙ† Ø¢Ø®Ø±ÙŠÙ†</option>
                    </select>
                </div>

                <div class="field">
                    <label for="adminSalarySegment">Ø´Ø±ÙŠØ­Ø© Ø§Ù„Ø±Ø§ØªØ¨</label>
                    <select id="adminSalarySegment"></select>
                    <small>Ø´Ø±Ø§Ø¦Ø­ Ø§Ù„Ø±Ø§ØªØ¨ ÙŠØªÙ… Ø¶Ø¨Ø·Ù‡Ø§ Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ§Ù„ÙŠ.</small>
                </div>

                <div class="field">
                    <label for="newSalarySegmentLabel">Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙŠØ­Ø© Ø±Ø§ØªØ¨ Ø¬Ø¯ÙŠØ¯Ø©</label>
                    <input type="text" id="newSalarySegmentLabel" placeholder="Ù…Ø«Ø§Ù„: Ù…Ù† 5,000 Ø¥Ù„Ù‰ 6,000 Ø±ÙŠØ§Ù„" />
                    <small>ØªØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´Ø±ÙŠØ­Ø© Ù„ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆÙ„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ….</small>
                </div>
                <div class="actions-row">
                    <button class="btn btn-outline btn-sm" onclick="addSalarySegment()">Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙŠØ­Ø© Ø±Ø§ØªØ¨</button>
                </div>

                <div class="admin-rules" id="salarySegmentsList"></div>

                <div class="field">
                    <label for="adminMonths">Ø¹Ø¯Ø¯ Ø£Ø´Ù‡Ø± Ø§Ù„ØªÙ…ÙˆÙŠÙ„</label>
                    <select id="adminMonths"></select>
                    <small>Ø§Ù„Ø£Ø´Ù‡Ø± Ù…ØªØ§Ø­Ø© Ù…Ù† 1 Ø¥Ù„Ù‰ 60 Ù„Ù„ØªÙ…ÙˆÙŠÙ„Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©ØŒ ÙˆØ­ØªÙ‰ 360 Ù„Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ.</small>
                </div>

                <div class="field">
                    <label for="adminRate">Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© (APR)</label>
                    <input type="number" id="adminRate" step="0.01" min="0" placeholder="Ù…Ø«Ø§Ù„: 2.99 Ø£Ùˆ 7" />
                </div>

                <div class="field">
                    <label for="adminNote">Ù…Ù„Ø§Ø­Ø¸Ø© / Ø¹Ø±Ø¶ Ø®Ø§Øµ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø´Ø±Ø· (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                    <textarea id="adminNote" placeholder="Ù…Ø«Ø§Ù„: Ø®ØµÙ… Ù†ØµÙ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© Ø£Ùˆ Ø¥Ø¹ÙØ§Ø¡ Ù…Ù† Ù‚Ø³Ø·ÙŠÙ† Ø£Ùˆ Ø¹Ø±Ø¶ Ø®Ø§Øµ Ù„Ø´Ø±ÙŠØ­Ø© Ù…Ø¹ÙŠÙ†Ø©"></textarea>
                </div>

                <div class="actions-row">
                    <button class="btn btn-primary btn-sm" onclick="saveAdminRate()">Ø­ÙØ¸ Ø§Ù„Ù†Ø³Ø¨Ø© ÙˆØ§Ù„Ø¹Ø±Ø¶</button>
                    <button class="btn btn-outline btn-sm" onclick="logoutAdmin()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
                </div>

                <div id="adminSaveMsg" class="admin-msg"></div>

                <div class="admin-rules" id="adminRulesList"></div>
            </div>
        </div>
    </section>

</main>

<footer>
    <span>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© &mdash; Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ©</span>
    <span id="liveDateTime">...</span>
</footer>

<script>
const banks = [
    { id: 'rajhi', name: 'Ù…ØµØ±Ù Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ', initials: 'Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ' },
    { id: 'inma', name: 'Ù…ØµØ±Ù Ø§Ù„Ø¥Ù†Ù…Ø§Ø¡', initials: 'Ø§Ù„Ø¥Ù†Ù…Ø§Ø¡' },
    { id: 'snb', name: 'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù‡Ù„ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ', initials: 'Ø§Ù„Ø£Ù‡Ù„ÙŠ' },
    { id: 'riyad', name: 'Ø¨Ù†Ùƒ Ø§Ù„Ø±ÙŠØ§Ø¶', initials: 'Ø§Ù„Ø±ÙŠØ§Ø¶' },
    { id: 'bilad', name: 'Ø¨Ù†Ùƒ Ø§Ù„Ø¨Ù„Ø§Ø¯', initials: 'Ø§Ù„Ø¨Ù„Ø§Ø¯' },
    { id: 'sabb', name: 'Ø³Ø§Ø¨', initials: 'Ø³Ø§Ø¨' },
    { id: 'fransi', name: 'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ Ø§Ù„ÙØ±Ù†Ø³ÙŠ', initials: 'Ø§Ù„ÙØ±Ù†Ø³ÙŠ' },
    { id: 'arab', name: 'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø§Ù„ÙˆØ·Ù†ÙŠ', initials: 'Ø§Ù„Ø¹Ø±Ø¨ÙŠ' },
    { id: 'jazira', name: 'Ø¨Ù†Ùƒ Ø§Ù„Ø¬Ø²ÙŠØ±Ø©', initials: 'Ø§Ù„Ø¬Ø²ÙŠØ±Ø©' },
    { id: 'gib', name: 'Ø¨Ù†Ùƒ Ø§Ù„Ø®Ù„ÙŠØ¬ Ø§Ù„Ø¯ÙˆÙ„ÙŠ', initials: 'Ø§Ù„Ø®Ù„ÙŠØ¬' },
    { id: 'emirates', name: 'Ø¨Ù†Ùƒ Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª Ø¯Ø¨ÙŠ Ø§Ù„ÙˆØ·Ù†ÙŠ', initials: 'Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª' }
];

const adminBankSelect = document.getElementById('adminBank');
if (adminBankSelect) {
    adminBankSelect.innerHTML =
        '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù†Ùƒ...</option>' +
        banks.map(b => `<option value="${b.id}">${b.name}</option>`).join('');
}

/* Ø´Ø±Ø§Ø¦Ø­ Ø§Ù„Ø±Ø§ØªØ¨ */
function loadSalarySegments() {
    try {
        const raw = localStorage.getItem('salarySegmentsV1');
        if (!raw) return [];
        return JSON.parse(raw);
    } catch (e) {
        return [];
    }
}
function saveSalarySegments(segments) {
    localStorage.setItem('salarySegmentsV1', JSON.stringify(segments));
}
function initSalarySegments() {
    let segments = loadSalarySegments();
    if (!segments || !segments.length) {
        segments = [{ id: 'general', label: 'Ø´Ø±ÙŠØ­Ø© Ø±Ø§ØªØ¨ Ø¹Ø§Ù…Ø©' }];
        saveSalarySegments(segments);
    }
    renderSalarySegmentsOptions();
    renderSalarySegmentsList();
}
function renderSalarySegmentsOptions() {
    const segments = loadSalarySegments();
    const clientSelect = document.getElementById('salarySegment');
    const adminSelect = document.getElementById('adminSalarySegment');
    let opts = '<option value="">Ø§Ø®ØªØ± Ø´Ø±ÙŠØ­Ø© Ø§Ù„Ø±Ø§ØªØ¨...</option>';
    segments.forEach(seg => {
        opts += `<option value="${seg.id}">${seg.label}</option>`;
    });
    if (clientSelect) clientSelect.innerHTML = opts;
    if (adminSelect) adminSelect.innerHTML = opts;
}
function renderSalarySegmentsList() {
    const container = document.getElementById('salarySegmentsList');
    if (!container) return;
    const segments = loadSalarySegments();
    if (!segments.length) {
        container.innerHTML = '<div class="empty-state" style="padding:4px 0 0;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´Ø±Ø§Ø¦Ø­ Ø±Ø§ØªØ¨ Ø¨Ø¹Ø¯.</div>';
        return;
    }
    container.innerHTML = segments.map(seg => `
        <div class="rule-row">
            <div>${seg.label}</div>
        </div>
    `).join('');
}
function addSalarySegment() {
    const input = document.getElementById('newSalarySegmentLabel');
    const label = (input.value || '').trim();
    const msg = document.getElementById('adminSaveMsg');
    msg.textContent = '';
    msg.className = 'admin-msg';
    if (!label) {
        msg.textContent = 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø´Ø±ÙŠØ­Ø© Ø§Ù„Ø±Ø§ØªØ¨ Ø£ÙˆÙ„Ø§Ù‹.';
        msg.classList.add('error');
        return;
    }
    let segments = loadSalarySegments();
    const id = 'seg' + Date.now();
    segments.push({ id, label });
    saveSalarySegments(segments);
    input.value = '';
    msg.textContent = 'ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙŠØ­Ø© Ø§Ù„Ø±Ø§ØªØ¨ Ø¨Ù†Ø¬Ø§Ø­.';
    msg.classList.add('success');
    renderSalarySegmentsOptions();
    renderSalarySegmentsList();
}
function getSalaryLabelById(id) {
    const segments = loadSalarySegments();
    const seg = segments.find(s => s.id === id);
    return seg ? seg.label : 'Ø´Ø±ÙŠØ­Ø© Ø±Ø§ØªØ¨';
}

/* Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ */
function goToStep(step) {
    for (let i = 1; i <= 3; i++) {
        document.getElementById(`step-pill-${i}`).classList.toggle('active', i === step);
        document.getElementById(`step-${i}`).style.display = (i === step ? 'block' : 'none');
    }
    if (step === 2) updateSupportVisibility();
    if (step === 3) fillMonthsForClient();
}
function updateSupportVisibility() {
    const financeType = document.getElementById('financeType').value;
    const employeeType = document.getElementById('employeeType').value;
    const supportField = document.getElementById('supportField');
    const itizezField = document.getElementById('itizezField');
    if (financeType === 'mortgage' || financeType === 'mortgage-buyout') {
        supportField.style.display = 'block';
    } else {
        supportField.style.display = 'none';
        document.getElementById('supportType').value = '';
    }
    const supportType = document.getElementById('supportType').value;
    if (employeeType === 'military' && financeType === 'mortgage' && supportType === 'supported') {
        itizezField.style.display = 'block';
    } else {
        itizezField.style.display = 'none';
        document.getElementById('itizezEligible').value = '';
    }
}
document.getElementById('financeType').addEventListener('change', updateSupportVisibility);
document.getElementById('employeeType').addEventListener('change', updateSupportVisibility);
document.getElementById('supportType').addEventListener('change', updateSupportVisibility);

function fillMonthsForClient() {
    const financeType = document.getElementById('financeType').value;
    const monthsSelect = document.getElementById('months');
    monthsSelect.innerHTML = '';
    let maxMonths = 60;
    let hint = '';
    if (financeType === 'mortgage' || financeType === 'mortgage-buyout') {
        maxMonths = 360;
        hint = 'Ù„Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† 1 Ø´Ù‡Ø± Ø­ØªÙ‰ 360 Ø´Ù‡Ø±.';
    } else {
        maxMonths = 60;
        hint = 'Ù„Ø¨Ù‚ÙŠØ© Ø§Ù„ØªÙ…ÙˆÙŠÙ„Ø§Øª ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† 1 Ø´Ù‡Ø± Ø­ØªÙ‰ 60 Ø´Ù‡Ø±.';
    }
    let options = '<option value="">Ø§Ø®ØªØ± Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø±...</option>';
    for (let m = 1; m <= maxMonths; m++) {
        options += `<option value="${m}">${m} Ø´Ù‡Ø±</option>`;
    }
    monthsSelect.innerHTML = options;
    document.getElementById('monthsHint').textContent = hint;
}

/* Ù…ÙØªØ§Ø­ Ø§Ù„Ù†Ø³Ø¨Ø© */
function buildRateKey(params) {
    const {
        financeType,
        supportType,
        employeeType,
        itizez,
        salarySegment,
        months
    } = params;
    const support = (financeType === 'mortgage' || financeType === 'mortgage-buyout')
        ? (supportType || 'any')
        : 'na';
    const itz = (employeeType === 'military' && support === 'supported')
        ? (itizez || 'any')
        : 'na';
    return [
        financeType || 'anyFT',
        support,
        employeeType || 'anyEmp',
        itz,
        salarySegment || 'anySal',
        months || 'anyM'
    ].join('|');
}

/* ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù†Ø³Ø¨ */
function loadRates() {
    try {
        const raw = localStorage.getItem('bankRatesV2');
        if (!raw) return {};
        return JSON.parse(raw);
    } catch (e) { return {}; }
}
function saveRates(data) {
    localStorage.setItem('bankRatesV2', JSON.stringify(data));
}

function saveAdminRate() {
    const bankId = document.getElementById('adminBank').value;
    const financeType = document.getElementById('adminFinanceType').value;
    const supportType = document.getElementById('adminSupportType').value;
    const employeeType = document.getElementById('adminEmployeeType').value;
    const salarySegment = document.getElementById('adminSalarySegment').value;
    const months = document.getElementById('adminMonths').value;
    const rateInput = document.getElementById('adminRate').value;
    const itizez = document.getElementById('adminItizez').value;
    const note = (document.getElementById('adminNote').value || '').trim();
    const msg = document.getElementById('adminSaveMsg');
    msg.textContent = ''; msg.className = 'admin-msg';

    if (!bankId || !financeType || !employeeType || !salarySegment || !months || !rateInput) {
        msg.textContent = 'ÙØ¶Ù„Ø§Ù‹ Ø£ÙƒÙ…Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸.';
        msg.classList.add('error');
        return;
    }
    if ((financeType === 'mortgage' || financeType === 'mortgage-buyout') && !supportType) {
        msg.textContent = 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø¹Ù… Ù„Ù‡Ø°Ø§ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ.';
        msg.classList.add('error');
        return;
    }
    if (employeeType === 'military' && financeType === 'mortgage' && supportType === 'supported' && !itizez) {
        msg.textContent = 'ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù†Ø³Ø¨Ø© Ø®Ø§ØµØ© Ø¨Ø¹Ù…Ù„Ø§Ø¡ Ø§Ø¹ØªØ²Ø§Ø² Ø£Ùˆ ØºÙŠØ±Ù‡Ù….';
        msg.classList.add('error');
        return;
    }
    const rate = Number(rateInput);
    if (!rate || rate <= 0) {
        msg.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù†Ø³Ø¨Ø© ØµØ­ÙŠØ­Ø© Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±.';
        msg.classList.add('error');
        return;
    }
    const key = buildRateKey({
        financeType,
        supportType,
        employeeType,
        itizez,
        salarySegment,
        months
    });
    const data = loadRates();
    if (!data[bankId]) data[bankId] = {};
    data[bankId][key] = { rate, note };
    saveRates(data);
    msg.textContent = 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†Ø³Ø¨Ø© (ÙˆØ§Ù„Ø¹Ø±Ø¶ Ø¥Ù† ÙˆØ¬Ø¯) Ø¨Ù†Ø¬Ø§Ø­ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¨Ù†Ùƒ ÙˆØ§Ù„Ø´Ø±ÙŠØ­Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© âœ…';
    msg.classList.add('success');
    renderAdminRules();
}

function deleteAdminRule(bankId, key) {
    const data = loadRates();
    if (data[bankId]) {
        delete data[bankId][key];
        saveRates(data);
    }
    renderAdminRules();
}

function renderAdminRules() {
    const bankId = document.getElementById('adminBank').value;
    const list = document.getElementById('adminRulesList');
    if (!list) return;
    if (!bankId) {
        list.innerHTML = '<div class="empty-state" style="padding:6px 0 2px;">Ø§Ø®ØªØ± Ø¨Ù†ÙƒÙ‹Ø§ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†Ù‘ÙØ³ÙØ¨ Ø§Ù„Ù…Ø­Ø¯Ø«Ø© Ù„Ù‡.</div>';
        return;
    }
    const data = loadRates();
    const bankData = data[bankId] || {};
    const entries = Object.entries(bankData);
    if (!entries.length) {
        list.innerHTML = '<div class="empty-state" style="padding:6px 0 2px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø³Ø¨ Ù…Ø®ØµØµØ© Ø¨Ø¹Ø¯ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¨Ù†Ùƒ.</div>';
        return;
    }
    list.innerHTML = entries.map(([key, val]) => {
        let rate, note;
        if (typeof val === 'number') {
            rate = val;
            note = '';
        } else {
            rate = val.rate;
            note = val.note || '';
        }
        const parts = key.split('|');
        const financeType = parts[0];
        const support = parts[1];
        const emp = parts[2];
        const itz = parts[3];
        const sal = parts[4];
        const months = parts[5];
        const financeLabel = mapFinanceType(financeType);
        const empLabel = mapEmployeeType(emp);
        const salLabel = getSalaryLabelById(sal);
        const supLabel = mapSupportType(support);
        const itzLabel = mapItizez(itz);
        return `
            <div class="rule-row">
                <div>
                    <strong>${financeLabel}</strong> - ${months} Ø´Ù‡Ø±
                    <br><small>${empLabel}${supLabel ? ' â€¢ ' + supLabel : ''}${itzLabel ? ' â€¢ ' + itzLabel : ''} â€¢ ${salLabel}</small>
                    ${note ? `<br><span class="rate-note">Ù…Ù„Ø§Ø­Ø¸Ø©: ${note}</span>` : ''}
                </div>
                <div style="text-align:left;">
                    <div style="font-weight:600;">${Number(rate).toFixed(2)}%</div>
                    <button onclick="deleteAdminRule('${bankId}','${key.replace(/'/g,"&#39;")}')">Ø­Ø°Ù</button>
                </div>
            </div>
        `;
    }).join('');
}

/* Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ù†Ø³Ø¨Ø© */
function getRateForBank(bankId, params) {
    const data = loadRates();
    const bankData = data[bankId] || {};
    const specificKey = buildRateKey(params);
    if (bankData.hasOwnProperty(specificKey)) {
        const val = bankData[specificKey];
        if (typeof val === 'number') {
            return { rate: val, source: 'Ù…Ø®ØµØµ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…', note: '' };
        } else {
            return { rate: val.rate, source: 'Ù…Ø®ØµØµ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…', note: val.note || '' };
        }
    }
    const months = Number(params.months || 0);
    const financeType = params.financeType;
    let baseRate = null;
    if (financeType === 'mortgage' || financeType === 'mortgage-buyout') {
        if (bankId === 'rajhi') baseRate = 2.99;
        else if (bankId === 'inma') baseRate = 7;
        else {
            if (months <= 60) baseRate = 6;
            else if (months <= 120) baseRate = 7;
            else if (months <= 180) baseRate = 8;
            else if (months <= 240) baseRate = 9;
            else if (months <= 300) baseRate = 10;
            else baseRate = 11;
        }
    } else {
        if (months <= 12) baseRate = 8;
        else if (months <= 24) baseRate = 9;
        else if (months <= 36) baseRate = 10;
        else if (months <= 48) baseRate = 11;
        else baseRate = 12;
    }
    return baseRate ? { rate: baseRate, source: 'Ù†Ø³Ø¨Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¹Ø§Ù…Ø©', note: '' } : null;
}

/* Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ±Ø´ÙŠØ­ Ù„Ù„Ø¹Ù…ÙŠÙ„ */
function calculateRecommendationClient() {
    const financeType = document.getElementById('financeType').value;
    const employeeType = document.getElementById('employeeType').value;
    const supportType = document.getElementById('supportType').value;
    const itizezEligible = document.getElementById('itizezEligible').value;
    const salarySegment = document.getElementById('salarySegment').value;
    const months = document.getElementById('months').value;
    if (!financeType || !employeeType || !salarySegment || !months) {
        alert('ÙØ¶Ù„Ø§Ù‹ ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ØŒ Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù…Ù„ØŒ Ø´Ø±ÙŠØ­Ø© Ø§Ù„Ø±Ø§ØªØ¨ ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø±.');
        return;
    }
    const params = {
        financeType,
        supportType,
        employeeType,
        itizez: itizezEligible,
        salarySegment,
        months
    };
    const results = banks.map(b => {
        const info = getRateForBank(b.id, params);
        return info ? { ...b, rate: info.rate, source: info.source, note: info.note } : null;
    }).filter(Boolean);
    if (!results.length) {
        document.getElementById('resultArea').innerHTML =
            '<div class="empty-state">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†Ø³Ø¨ Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ø·ÙŠØ§Øª. ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‘ÙØ³ÙØ¨.</div>';
        return;
    }
    results.sort((a, b) => a.rate - b.rate);
    const best = results[0];
    const financeLabel = mapFinanceType(financeType);
    const empLabel = mapEmployeeType(employeeType);
    const salLabel = getSalaryLabelById(salarySegment);
    const supLabel = mapSupportType(
        (financeType === 'mortgage' || financeType === 'mortgage-buyout') ? supportType : 'na'
    );
    const itzLabel = mapItizez(
        (employeeType === 'military' && supportType === 'supported') ? itizezEligible : 'na'
    );
    let html = '';
    html += '<div class="result-main-card">';
    html += '  <div class="result-main-top">';
    html += `    <div class="bank-logo">${best.initials}</div>`;
    html += '    <div>';
    html += '      <h3>ØªÙ… ØªØ±Ø´ÙŠØ­ Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù†Ø³Ø¨ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„</h3>';
    html += `      <p><strong>${best.name}</strong></p>`;
    html += `      <p>Ù†Ø³Ø¨Ø© Ù…ØªÙˆÙ‚Ø¹Ø© Ù„Ù„ØªÙ…ÙˆÙŠÙ„: <strong>${best.rate.toFixed(2)}%</strong></p>`;
    html += `      <span class="badge-pill">${best.source}</span>`;
    if (best.note) {
        html += `      <p class="rate-note" style="margin-top:4px;">Ù…Ù„Ø§Ø­Ø¸Ø© / Ø¹Ø±Ø¶ Ø®Ø§Øµ: ${best.note}</p>`;
    }
    html += '    </div>';
    html += '  </div>';
    html += '  <p class="muted" style="margin-top:8px;">';
    html += `Ø§Ù„ØªÙ…ÙˆÙŠÙ„: ${financeLabel} â€¢ ${empLabel}`;
    if (supLabel) html += ` â€¢ ${supLabel}`;
    if (itzLabel) html += ` â€¢ ${itzLabel}`;
    html += ` â€¢ ${salLabel} â€¢ Ù…Ø¯Ø© ${months} Ø´Ù‡Ø±`;
    html += '</p>';
    html += '</div>';
    html += '<div class="banks-list">';
    html += '  <p style="margin:0 0 4px;font-size:13px;">ØªØ±ØªÙŠØ¨ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¨Ù†ÙˆÙƒ Ø­Ø³Ø¨ Ø§Ù„Ù†Ø³Ø¨Ø© (Ù…Ù† Ø§Ù„Ø£Ù‚Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø¹Ù„Ù‰):</p>';
    html += '  <table>';
    html += '    <thead><tr><th>Ø§Ù„Ø¨Ù†Ùƒ</th><th>Ø§Ù„Ù†Ø³Ø¨Ø© %</th><th>Ø§Ù„Ù…ØµØ¯Ø± / Ø§Ù„Ø¹Ø±Ø¶</th></tr></thead><tbody>';
    results.forEach((b, index) => {
        html += `<tr${index === 0 ? ' style="font-weight:600;background:#fef9e7;"' : ''}>`;
        html += `  <td>${b.name}</td>`;
        html += `  <td>${b.rate.toFixed(2)}</td>`;
        html += '  <td class="rate-source">';
        html += b.source;
        if (b.note) {
            html += `<br><span class="rate-note">Ø¹Ø±Ø¶: ${b.note}</span>`;
        }
        html += '  </td>';
        html += '</tr>';
    });
    html += '  </tbody></table>';
    html += '</div>';
    html += '<div class="disclaimer">';
    html += '  <span class="icon">âš ï¸</span>';
    html += '  <span>Ù‡Ø°Ø§ Ø§Ù„ØªØ±Ø´ÙŠØ­ Ù…Ø¨Ø¯Ø¦ÙŠ Ø§Ø³ØªØ±Ø´Ø§Ø¯ÙŠØŒ ÙˆÙ„Ø§ ÙŠÙØ¹Ø¯ Ø¹Ø±Ø¶Ù‹Ø§ Ù…Ù„Ø²Ù…Ù‹Ø§. Ù‚Ø¯ ØªØ®ØªÙ„Ù Ø§Ù„Ù†Ù‘ÙØ³ÙØ¨ Ø§Ù„ÙØ¹Ù„ÙŠØ© Ø­Ø³Ø¨ Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø¨Ù†ÙƒØŒ ÙˆØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ù„Ø§Ø¡Ø© Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù†ÙŠØ©ØŒ ÙˆØ¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ø¯Ø¹Ù…. ÙŠØ¬Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆÙ…Ù‚Ø¯Ù… Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø±Ø³Ù…ÙŠØ© ÙˆØ§Ù„Ø®Ø·Ø§Ø¨Ø§Øª Ø§Ù„ØµØ§Ø¯Ø±Ø© Ù…Ù† Ø§Ù„Ø¨Ù†Ùƒ Ø£Ùˆ Ø¬Ù‡Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù‚Ø¨Ù„ Ø§ØªØ®Ø§Ø° Ø£ÙŠ Ù‚Ø±Ø§Ø± ØªÙ…ÙˆÙŠÙ„ÙŠ.</span>';
    html += '</div>';
    html += '<div class="screenshot-note">';
    html += 'ğŸ“¸ Ø®Ø° Ù„Ù‚Ø·Ø© Ù„Ù„Ø´Ø§Ø´Ø© ÙˆØ´Ø§Ø±ÙƒÙ‡Ø§ Ù…Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„ØŒ Ø£Ùˆ ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø¹Ù„Ù‰ ';
    html += '<a href="tel:0506214458">0506214458</a> ';
    html += 'Ø£Ùˆ Ø¹Ø¨Ø± Ù…ÙˆÙ‚Ø¹Ù†Ø§ ';
    html += '<a href="https://hlooleqrr.com" target="_blank" rel="noopener">hlooleqrr.com</a>.';
    html += '</div>';
    document.getElementById('resultArea').innerHTML = html;
}

/* Ø®Ø±Ø§Ø¦Ø· Ø§Ù„Ù†ØµÙˆØµ */
function mapFinanceType(v) {
    switch (v) {
        case 'mortgage': return 'ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ';
        case 'mortgage-buyout': return 'Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø¹Ù‚Ø§Ø±ÙŠ';
        case 'personal': return 'ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ';
        case 'personal-buyout': return 'Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø´Ø®ØµÙŠ';
        case 'consumer': return 'ØªÙ…ÙˆÙŠÙ„ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ';
        case 'car-lease': return 'ØªÙ…ÙˆÙŠÙ„ ØªØ£Ø¬ÙŠØ± Ù…Ø±ÙƒØ¨Ø§Øª';
        default: return 'ØªÙ…ÙˆÙŠÙ„ Ø¹Ø§Ù…';
    }
}
function mapEmployeeType(v) {
    switch (v) {
        case 'civil': return 'Ø¹Ù…ÙŠÙ„ Ù…Ø¯Ù†ÙŠ / Ø­ÙƒÙˆÙ…ÙŠ';
        case 'military': return 'Ø¹Ù…ÙŠÙ„ Ø¹Ø³ÙƒØ±ÙŠ';
        case 'semi-gov': return 'Ø´Ø¨Ù‡ Ø­ÙƒÙˆÙ…ÙŠ';
        case 'private': return 'Ù‚Ø·Ø§Ø¹ Ø®Ø§Øµ';
        default: return 'Ø¬Ù‡Ø© Ø¹Ù…Ù„ Ø¹Ø§Ù…Ø©';
    }
}
function mapSupportType(v) {
    switch (v) {
        case 'supported': return 'ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ Ù…Ø¯Ø¹ÙˆÙ…';
        case 'unsupported': return 'ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…';
        default: return '';
    }
}
function mapItizez(v) {
    switch (v) {
        case 'yes': return 'Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø¨Ø§Ø¯Ø±Ø© Ø§Ø¹ØªØ²Ø§Ø² - ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¯ÙØ§Ø¹';
        case 'no': return 'Ø¹Ø³ÙƒØ±ÙŠ ØºÙŠØ± Ù…Ø´Ù…ÙˆÙ„ Ø¨Ø§Ø¹ØªØ²Ø§Ø²';
        default: return '';
    }
}

/* Ø¯Ø®ÙˆÙ„/Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ */
function adminLogin() {
    const pass = document.getElementById('adminPassword').value;
    const msg = document.getElementById('adminLoginMsg');
    msg.textContent = ''; msg.className = 'admin-msg';
    if (pass === '11qq11qQ@') {
        document.getElementById('adminPassword').value = '';
        document.getElementById('admin-login').style.display = 'none';
        document.getElementById('admin-panel').style.display = 'block';
        msg.textContent = '';
        renderAdminRules();
        renderSalarySegmentsOptions();
        renderSalarySegmentsList();
    } else {
        msg.textContent = 'ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙˆØµÙˆÙ„ØŒ Ù„Ø§ ØªÙƒØ±Ø± Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø­ØªÙ‰ Ù„Ø§ ÙŠØªÙ… Ø­Ø¬Ø¨ Ø¬Ù‡Ø§Ø²Ùƒ.';
        msg.classList.add('error');
    }
}
function logoutAdmin() {
    document.getElementById('admin-panel').style.display = 'none';
    document.getElementById('admin-login').style.display = 'block';
    document.getElementById('adminLoginMsg').textContent = '';
}

/* ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ */
function adminFinanceTypeChanged() {
    const financeType = document.getElementById('adminFinanceType').value;
    const supportWrapper = document.getElementById('adminSupportWrapper');
    const monthsSelect = document.getElementById('adminMonths');
    if (financeType === 'mortgage' || financeType === 'mortgage-buyout') {
        supportWrapper.style.display = 'block';
    } else {
        supportWrapper.style.display = 'none';
        document.getElementById('adminSupportType').value = '';
    }
    monthsSelect.innerHTML = '';
    let max = 60;
    if (financeType === 'mortgage' || financeType === 'mortgage-buyout') {
        max = 360;
    }
    let options = '<option value="">Ø§Ø®ØªØ± Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø±...</option>';
    for (let m = 1; m <= max; m++) {
        options += `<option value="${m}">${m} Ø´Ù‡Ø±</option>`;
    }
    monthsSelect.innerHTML = options;
}

/* ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠØ©/Ø§Ù„Ø¯Ø¹Ù… */
function adminEmployeeChanged() {
    const emp = document.getElementById('adminEmployeeType').value;
    const financeType = document.getElementById('adminFinanceType').value;
    const supportType = document.getElementById('adminSupportType').value;
    const itzWrap = document.getElementById('adminItizezWrapper');
    if (emp === 'military' && financeType === 'mortgage' && supportType === 'supported') {
        itzWrap.style.display = 'block';
    } else {
        itzWrap.style.display = 'none';
        document.getElementById('adminItizez').value = '';
    }
}

/* Ø²Ø± Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ */
function showAdminSection() {
    const wrap = document.getElementById('admin-section-wrapper');
    if (wrap) {
        wrap.style.display = 'block';
        wrap.scrollIntoView({ behavior: 'smooth' });
    }
}

/* Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª */
function updateDateTime() {
    const now = new Date();
    const days = ['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª'];
    const dayName = days[now.getDay()];
    const date = now.toLocaleDateString('ar-EG', { year: 'numeric', month: '2-digit', day: '2-digit' });
    const time = now.toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false });
    document.getElementById('liveDateTime').textContent = `${dayName} - ${date} - ${time}`;
}
updateDateTime();
setInterval(updateDateTime, 1000);

/* Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø¨Ø¯Ø¦ÙŠ */
adminFinanceTypeChanged();
initSalarySegments();
goToStep(1);
</script>

</body>
</html>