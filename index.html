<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù…Ù†ØµØ© FINO - Ø­Ø§Ø³Ø¨Ø© ÙˆØªÙ…ÙŠÙŠØ² Ø§Ù„Ø¨Ù†ÙˆÙƒ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Tajawal', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f3f4f6;
      margin: 0;
      text-align: center;
      font-size: 20px;
      direction: rtl;
      color: #111827;
    }
    header {
      background: linear-gradient(135deg, #0f172a, #1e3a8a);
      color: #fff;
      padding: 14px 10px;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    header h1 {
      margin: 0;
      font-size: 24px;
      font-weight: 700;
      letter-spacing: 0.03em;
    }
    header p {
      margin: 4px 0 0;
      font-size: 16px;
      opacity: 0.95;
    }
    .top-bar {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      max-width: 900px;
      margin: 0 auto;
    }

    .page-container {
      max-width: 900px;
      margin: 16px auto 32px;
      padding: 0 10px;
    }
    .card {
      background: #ffffff;
      border-radius: 18px;
      padding: 18px 16px;
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.06);
      margin-bottom: 14px;
      text-align: center;
      width: 100%;
    }

    button, .btn {
      border-radius: 999px;
      border: none;
      padding: 14px 22px;
      font-size: 19px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: transform .12s ease, box-shadow .12s ease, background .12s ease, opacity .12s ease;
    }
    button.primary, .btn.primary {
      background: #2563eb;
      color: #ffffff;
      box-shadow: 0 8px 16px rgba(37, 99, 235, 0.35);
    }
    button.primary:hover, .btn.primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(37, 99, 235, 0.45);
      background: #1d4ed8;
    }
    button.secondary, .btn.secondary {
      background: #e0f2fe;
      color: #1d4ed8;
    }
    button.secondary:hover, .btn.secondary:hover {
      background: #dbeafe;
    }
    button.small, .btn.small {
      padding: 12px 20px;
      font-size: 18px;
    }

    input, select {
      width: 100%;
      padding: 11px 12px;
      margin: 8px 0 2px;
      font-size: 18px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      text-align: right;
      background: #f9fafb;
      color: #111827;
    }
    input:focus, select:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.35);
      background: #ffffff;
    }
    label {
      display: block;
      text-align: right;
      font-size: 17px;
      margin-top: 8px;
      margin-bottom: 2px;
      color: #374151;
    }

    .fade-in {
      animation: fadeInMove .3s ease-out forwards;
      opacity: 0;
      transform: translateY(10px);
    }
    @keyframes fadeInMove {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .page { display: none; }
    .page.active { display: block; }

    .welcome-title {
      font-size: 23px;
      margin-bottom: 6px;
      color: #111827;
    }
    .welcome-sub {
      font-size: 15px;
      color: #6b7280;
      margin-bottom: 18px;
    }

    .steps-badge {
      font-size: 14px;
      color: #6b7280;
      margin-bottom: 6px;
      text-align: right;
    }

    .result-header {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 6px;
    }
    .client-chip {
      background: #e0f2fe;
      color: #1d4ed8;
      border-radius: 999px;
      padding: 6px 14px;
      font-size: 14px;
    }
    .badge-mode {
      background: #eff6ff;
      color: #1d4ed8;
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 12px;
      display: inline-block;
    }
    .badge-duration {
      background: #e0f2fe;
      color: #1e3a8a;
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 12px;
      display: inline-block;
      margin-top: 3px;
    }

    .bank-card {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border-radius: 16px;
      background: #eff6ff;
      border: 1px dashed #2563eb;
      margin: 8px 0 12px;
      text-align: right;
    }
    .bank-logo {
      width: 48px;
      height: 48px;
      border-radius: 14px;
      background: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      flex-shrink: 0;
      border: 1px solid #e5e7eb;
    }
    .bank-logo img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }
    .bank-text-main {
      font-size: 16px;
      font-weight: 600;
      color: #0f172a;
    }
    .bank-text-sub {
      font-size: 13px;
      color: #4b5563;
    }

    .result-main-block {
      background: radial-gradient(circle at top, #e0f2fe 0, #ffffff 60%);
      border-radius: 18px;
      padding: 12px 14px;
      margin-top: 4px;
      text-align: right;
      border: 1px solid #bfdbfe;
    }
    .result-main-title {
      font-size: 15px;
      color: #1d4ed8;
      margin-bottom: 2px;
    }
    .result-amount-main {
      font-size: 26px;
      font-weight: 800;
      color: #1e40af;
      margin: 2px 0;
    }
    .result-amount-sub {
      font-size: 14px;
      color: #1d4ed8;
      margin: 2px 0;
    }
    .result-amount-small {
      font-size: 13px;
      color: #374151;
      margin-top: 2px;
    }

    .dual-main-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(180px,1fr));
      gap: 8px;
      margin-top: 8px;
    }
    .dual-box {
      background: #eff6ff;
      border-radius: 14px;
      padding: 8px 10px;
      font-size: 13px;
      text-align: right;
      border: 1px solid #dbeafe;
    }
    .dual-box-title {
      font-size: 13px;
      color: #1d4ed8;
      margin-bottom: 2px;
    }
    .dual-box-amount {
      font-size: 18px;
      font-weight: 700;
      color: #1e3a8a;
    }

    .result-section-title {
      text-align: right;
      font-size: 16px;
      font-weight: 700;
      margin: 12px 0 6px;
      color: #111827;
    }
    .result-section-box {
      border-radius: 16px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      padding: 10px 12px;
      text-align: right;
    }

    .instalment-row {
      font-size: 14px;
      padding: 4px 0;
      border-bottom: 1px dashed #e5e7eb;
      text-align: right;
      color: #374151;
    }

    .alert-error {
      color: #b91c1c;
      background: #fef2f2;
      border-radius: 12px;
      padding: 8px 10px;
      font-size: 14px;
      margin: 6px 0;
      text-align: right;
      border: 1px solid #fecaca;
    }

    .admin-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(180px,1fr));
      gap: 8px 12px;
      margin-top: 6px;
      text-align: right;
    }
    .admin-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    .admin-table th, .admin-table td {
      border: 1px solid #e5e7eb;
      padding: 5px 6px;
      font-size: 12px;
      text-align: center;
    }
    .admin-table th {
      background: #f3f4f6;
      color: #374151;
    }

    footer {
      font-size: 13px;
      color: #6b7280;
      margin-top: 10px;
      padding: 8px 12px;
      position: relative;
      background: #f9fafb;
      border-top: 1px solid #e5e7eb;
    }

    .footer-inner {
      max-width: 900px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    #adminIcon {
      border-radius: 999px;
      background: #e5e7eb;
      padding: 6px 12px;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      color: #111827;
    }
    #adminIcon:hover {
      background: #d1d5db;
    }

    #resultCard {
      /* Ø·Ø¨ÙŠØ¹ÙŠ Ø¨Ø¯ÙˆÙ† Ø§Ø±ØªÙØ§Ø¹ Ø¥Ø¬Ø¨Ø§Ø±ÙŠ */
    }
  </style>
</head>
<body>

<header>
  <div class="top-bar">
    <div style="text-align:right">
      <h1>Ù…Ù†ØµØ© FINO</h1>
      <p>Ù…Ù†ØµØ© Ø°ÙƒÙŠØ© ØªØ­Ø³Ø¨ Ù„Ùƒ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ ÙˆØªÙØ±Ø´Ù‘Ø­ Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù†Ø³Ø¨ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø±Ø§ØªØ¨Ùƒ ÙˆØ§Ù„ØªØ²Ø§Ù…Ø§ØªÙƒ Ø®Ù„Ø§Ù„ Ø«ÙˆØ§Ù†ÙØŒ Ø¨Ø¯ÙˆÙ† Ø­ÙŠØ±Ø© ÙˆÙ„Ø§ ØªØ¹Ø¨</p>
    </div>
  </div>
</header>

<div class="page-container">

  <!-- ØµÙØ­Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ -->
  <div id="landingPage" class="page active">
    <div class="card fade-in">
      <div class="welcome-title">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ğŸ‘‹</div>
      <div class="welcome-sub">
        Ù…Ù† Ù‡Ù†Ø§ ØªÙ‚Ø¯Ø± ØªØ­Ø³Ø¨ ØªÙ…ÙˆÙŠÙ„Ùƒ ÙˆØªØ´ÙˆÙ Ø£ÙØ¶Ù„ Ø¨Ù†Ùƒ Ù…Ù†Ø§Ø³Ø¨ Ù„Ùƒ Ù…Ù† Ø­ÙŠØ« Ø§Ù„Ù†Ø³Ø¨Ø© Ø­Ø³Ø¨ Ø±Ø§ØªØ¨Ùƒ ÙˆÙ†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ ÙˆØ§Ù„ØªØ²Ø§Ù…Ø§ØªÙƒ.
      </div>
      <button class="primary" onclick="startClientFlow()">
        Ø§Ø¨Ø¯Ø£ Ø¨Ø£Ø³Ù… Ø§Ù„Ù„Ù‡
      </button>
      <div style="margin-top:12px; font-size:13px; color:#6b7280;">
        Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ù…ØµÙ…Ù…Ø© Ø¨Ø­ÙŠØ« ØªÙ‚Ø¯Ø± ØªØµÙˆÙ‘Ø± Ø§Ù„Ø´Ø§Ø´Ø© Ø£Ùˆ ØªØ­ÙØ¸Ù‡Ø§ ÙƒØµÙˆØ±Ø© .
      </div>

      <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ ÙÙ‚Ø· -->
      <div style="margin-top:16px; display:flex; justify-content:center;">
        <div id="adminIcon" title="Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ† ğŸ› ï¸" onclick="showPage('adminLogin')">
          ğŸ› ï¸ <span style="font-size:12px;">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ø³Ø¨Ø© -->
  <div id="calculatorPage" class="page">
    <div class="card">
      <div class="steps-badge">
        Ø£Ø³Ø¦Ù„Ø© Ø¨Ø³ÙŠØ·Ø© Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ© Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ø£Ø¯Ù‚ Ø­Ø³Ø¨Ø© Ù…Ù…ÙƒÙ†Ø© ğŸ‘Œ
      </div>
      <div id="question"></div>
      <div style="margin-top:14px; display:flex; justify-content:flex-end; gap:8px; flex-wrap:wrap;">
        <button id="nextButton" class="primary small" style="display:none;" onclick="nextQuestion()">Ø§Ù„ØªØ§Ù„ÙŠ</button>
        <button id="mainButton" class="primary small" onclick="handleStartOrReset()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø­Ø³Ø¨Ø©</button>
      </div>
      <div id="resetButtonContainer" style="margin-top:8px; display:none;">
        <button class="secondary small" onclick="resetCalc()">ğŸ” Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø³Ø¨Ø©</button>
      </div>
    </div>
  </div>

  <!-- ØµÙØ­Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© -->
  <div id="resultPage" class="page">
    <div class="card fade-in" id="resultCard">
      <!-- ØªØ¹Ø¨Ø¦Ø© Ù…Ù† Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±Ø¨Øª -->
    </div>
    <div style="margin-top:10px; display:flex; justify-content:space-between; gap:8px; flex-wrap:wrap;">
      <button class="secondary small" onclick="backToLanding()">ğŸ  Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
      <div style="display:flex; gap:8px; flex-wrap:wrap;">
        <button class="secondary small" onclick="saveResultAsImage()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙƒØµÙˆØ±Ø©</button>
        <button class="primary small" onclick="resetCalc(); showPage('calculator');">ğŸ” Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
      </div>
    </div>
  </div>

  <!-- ØµÙØ­Ø© "Ù‚Ø±ÙŠØ¨Ø§Ù‹" Ù„Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ -->
  <div id="comingSoonPage" class="page">
    <div class="card fade-in">
      <h2 style="margin-top:0; font-size:19px; color:#111827;">Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ</h2>
      <p style="font-size:14px; color:#6b7280;">
        Ø­Ø§Ù„ÙŠØ§Ù‹ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ø­ØªØ³Ø§Ø¨ Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ© Ø¹Ø¨Ø± Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ø³Ø¨Ø©.<br>
        Ø³ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ø¯Ù…Ø© ÙÙŠ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ø¥Ù† Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡ ğŸ™
      </p>
      <div style="margin-top:12px;">
        <button class="secondary small" onclick="backToLanding()">ğŸ  Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
      </div>
    </div>
  </div>

  <!-- ØµÙØ­Ø© Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ -->
  <div id="adminLoginPage" class="page">
    <div class="card fade-in">
      <h2 style="margin-top:0; font-size:19px; color:#111827;">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±Ù</h2>
      <p style="font-size:13px; color:#b91c1c; text-align:right;">
        âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ù…Ø®ØµØµ Ù„Ù„Ù…Ø´Ø±ÙÙŠÙ† Ø§Ù„Ù…Ø±Ø®Øµ Ù„Ù‡Ù… ÙÙ‚Ø·.<br>
        Ø£ÙŠ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¯Ø®ÙˆÙ„ Ø¨Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø© Ù‚Ø¯ ØªØ¹ØªØ¨Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Ù‹ ØºÙŠØ± Ù…ØµØ±Ø­ Ø¨Ù‡.
      </p>
      <label for="adminPin">Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„</label>
      <input id="adminPin" type="password" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ù…Ø´Ø±Ù" />
      <div style="margin-top:12px;">
        <button class="primary small" onclick="handleAdminLogin()">Ø¯Ø®ÙˆÙ„</button>
        <button class="secondary small" onclick="backToLanding()">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
      <div id="adminLoginError" class="alert-error" style="display:none; margin-top:8px;">
        Ø§Ù„Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.
      </div>
    </div>
  </div>

  <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ -->
  <div id="adminPage" class="page">
    <div class="card fade-in">
      <h2 style="margin-top:0; font-size:19px; color:#111827;">Ù„ÙˆØ­Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ù†ÙˆÙƒ</h2>
      <p style="font-size:13px; color:#6b7280; text-align:right;">
        Ù…Ù† Ù‡Ù†Ø§ ØªØ¶ÙŠÙ ÙˆØªØ¹Ø¯Ù‘Ù„ Ø´Ø±Ø§Ø¦Ø­ Ø§Ù„Ø±ÙˆØ§ØªØ¨ ÙˆÙ†Ø³Ø¨ Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ù„ÙƒÙ„ Ø¨Ù†Ùƒ ÙˆÙ†ÙˆØ¹ ØªÙ…ÙˆÙŠÙ„.  
        Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ³ØªØ®Ø¯Ù… ÙÙŠ Ø®ÙŠØ§Ø± <strong>ØªØ±Ø´ÙŠØ­ Ø¨Ù†Ùƒ Ù…Ù†Ø§Ø³Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</strong>.
      </p>

      <form id="adminForm" onsubmit="saveBankConfig(event)">
        <div class="admin-grid">
          <div>
            <label>Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ</label>
            <select id="adminBankName">
              <option value="">Ø§Ø®ØªØ±...</option>
              <option>Ù…ØµØ±Ù Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ</option>
              <option>Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù‡Ù„ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ</option>
              <option>Ø¨Ù†Ùƒ Ø§Ù„Ø±ÙŠØ§Ø¶</option>
              <option>Ø¨Ù†Ùƒ Ø§Ù„Ø¨Ù„Ø§Ø¯</option>
              <option>Ø¨Ù†Ùƒ Ø§Ù„Ø¬Ø²ÙŠØ±Ø©</option>
              <option>Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ Ø§Ù„ÙØ±Ù†Ø³ÙŠ</option>
              <option>Ø¨Ù†Ùƒ Ø³Ø§Ø¨</option>
              <option>Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø§Ù„ÙˆØ·Ù†ÙŠ</option>
              <option>Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ Ù„Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±</option>
              <option>Ø¨Ù†Ùƒ Ø¢Ø®Ø± (  )</option>
            </select>
          </div>
          <div>
            <label>Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„</label>
            <select id="adminFinanceType">
              <option value="personal">ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ / Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ</option>
              <option value="mortgage">ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ</option>
              <option value="buyoutPersonal">Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ</option>
              <option value="buyoutMortgage">Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ</option>
            </select>
          </div>
          <div>
            <label>Ù†ÙˆØ¹ Ø§Ù„Ø¯Ø¹Ù… (Ù„Ù„Ø¹Ù‚Ø§Ø±ÙŠ)</label>
            <select id="adminSupportedType">
              <option value="Ø§Ù„ÙƒÙ„">Ø§Ù„ÙƒÙ„</option>
              <option value="Ù…Ø¯Ø¹ÙˆÙ…">Ù…Ø¯Ø¹ÙˆÙ…</option>
              <option value="ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…">ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…</option>
            </select>
          </div>
          <div>
            <label>Ù…Ù† Ø±Ø§ØªØ¨ (Ø±ÙŠØ§Ù„)</label>
            <input id="adminMinSalary" type="number" min="0" />
          </div>
          <div>
            <label>Ø¥Ù„Ù‰ Ø±Ø§ØªØ¨ (Ø±ÙŠØ§Ù„)</label>
            <input id="adminMaxSalary" type="number" min="0" />
          </div>
          <div>
            <label>Ù†Ø³Ø¨Ø© Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ (%)</label>
            <input id="adminMargin" type="number" min="0" step="0.01" />
          </div>
        </div>
        <input type="hidden" id="adminEditIndex" value="" />
        <div style="text-align:left; margin-top:10px;">
          <button type="submit" class="primary small">ğŸ’¾ Ø­ÙØ¸</button>
          <button type="button" class="secondary small" onclick="clearAdminForm()">Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</button>
        </div>
      </form>

      <table class="admin-table" id="adminTable">
        <thead>
          <tr>
            <th>Ø§Ù„Ø¨Ù†Ùƒ</th>
            <th>Ø§Ù„ØªÙ…ÙˆÙŠÙ„</th>
            <th>Ø§Ù„Ø¯Ø¹Ù…</th>
            <th>Ù…Ù† Ø±Ø§ØªØ¨</th>
            <th>Ø¥Ù„Ù‰ Ø±Ø§ØªØ¨</th>
            <th>Ø§Ù„Ù†Ø³Ø¨Ø© %</th>
            <th>ØªØ­ÙƒÙ…</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div style="margin-top:8px; font-size:11px; color:#9ca3af; text-align:right;">
        Ù…Ù„Ø§Ø­Ø¸Ø©: Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¨Ù†ÙˆÙƒ ØªÙØ¬Ù„Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ.  
        Ø¶Ø¹ Ù…Ù„ÙØ§Øª Ø§Ù„ØµÙˆØ± ÙÙŠ Ù…Ø¬Ù„Ø¯ <code>img</code> Ø¨Ù†ÙØ³ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø´Ø§Ø± Ø¥Ù„ÙŠÙ‡Ø§ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯.
      </div>

      <div style="margin-top:12px; text-align:left;">
        <button class="secondary small" onclick="backToLanding()">ğŸ  Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
      </div>
    </div>
  </div>

</div>

<footer>
  <div class="footer-inner">
    <div>
      Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© -  Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ© -
      <span id="datetime"></span>
    </div>
  </div>
</footer>

<!-- Ù…ÙƒØªØ¨Ø© Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙƒØµÙˆØ±Ø© -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
  function showPage(name) {
    ['landing','calculator','result','adminLogin','admin','comingSoon'].forEach(id => {
      const el = document.getElementById(id + 'Page');
      if (!el) return;
      el.classList.toggle('active', id === name);
    });
  }

  function backToLanding() {
    showPage('landing');
  }

  function startClientFlow() {
    showPage('calculator');
    resetCalc();
  }

  const bankLogoMap = {
    'Ù…ØµØ±Ù Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ': 'img/alrajhi.png',
    'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù‡Ù„ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ': 'img/alahli.png',
    'Ø¨Ù†Ùƒ Ø§Ù„Ø±ÙŠØ§Ø¶': 'img/riyad.png',
    'Ø¨Ù†Ùƒ Ø§Ù„Ø¨Ù„Ø§Ø¯': 'img/bilad.png',
    'Ø¨Ù†Ùƒ Ø§Ù„Ø¬Ø²ÙŠØ±Ø©': 'img/jazira.png',
    'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ Ø§Ù„ÙØ±Ù†Ø³ÙŠ': 'img/bsf.png',
    'Ø¨Ù†Ùƒ Ø³Ø§Ø¨': 'img/sab.png',
    'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø§Ù„ÙˆØ·Ù†ÙŠ': 'img/anb.png',
    'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ Ù„Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±': 'img/saib.png'
  };

  let bankConfigs = [];

  const defaultBankConfigs = [
    { bankName: 'Ù…ØµØ±Ù Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ', financeType: 'personal', supportedType: 'Ø§Ù„ÙƒÙ„', minSalary: 4000, maxSalary: 8000, margin: 5.5 },
    { bankName: 'Ù…ØµØ±Ù Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ', financeType: 'personal', supportedType: 'Ø§Ù„ÙƒÙ„', minSalary: 8001, maxSalary: 20000, margin: 4.9 },
    { bankName: 'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù‡Ù„ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ', financeType: 'mortgage', supportedType: 'Ù…Ø¯Ø¹ÙˆÙ…', minSalary: 4000, maxSalary: 15000, margin: 4.3 },
    { bankName: 'Ø¨Ù†Ùƒ Ø§Ù„Ø±ÙŠØ§Ø¶', financeType: 'mortgage', supportedType: 'ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…', minSalary: 6000, maxSalary: 20000, margin: 4.8 }
  ];

  function loadBankConfigs() {
    try {
      const saved = localStorage.getItem('stBankConfigs');
      if (saved) {
        bankConfigs = JSON.parse(saved);
      } else {
        bankConfigs = defaultBankConfigs;
        saveBankConfigs();
      }
    } catch (e) {
      bankConfigs = defaultBankConfigs;
    }
    renderBankTable();
  }

  function saveBankConfigs() {
    localStorage.setItem('stBankConfigs', JSON.stringify(bankConfigs));
  }

  function renderBankTable() {
    const tbody = document.querySelector('#adminTable tbody');
    tbody.innerHTML = '';
    bankConfigs.forEach((cfg, index) => {
      let financeLabel =
        cfg.financeType === 'personal' ? 'Ø´Ø®ØµÙŠ/Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ' :
        cfg.financeType === 'mortgage' ? 'Ø¹Ù‚Ø§Ø±ÙŠ' :
        cfg.financeType === 'buyoutPersonal' ? 'Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø´Ø®ØµÙŠ' :
        cfg.financeType === 'buyoutMortgage' ? 'Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø¹Ù‚Ø§Ø±ÙŠ' :
        cfg.financeType;

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${cfg.bankName}</td>
        <td>${financeLabel}</td>
        <td>${cfg.supportedType}</td>
        <td>${cfg.minSalary.toLocaleString()}</td>
        <td>${cfg.maxSalary.toLocaleString()}</td>
        <td>${cfg.margin}</td>
        <td>
          <button class="btn small secondary" onclick="editBankConfig(${index})">ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="btn small secondary" onclick="deleteBankConfig(${index})">Ø­Ø°Ù</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  }

  function clearAdminForm() {
    document.getElementById('adminBankName').value = '';
    document.getElementById('adminFinanceType').value = 'personal';
    document.getElementById('adminSupportedType').value = 'Ø§Ù„ÙƒÙ„';
    document.getElementById('adminMinSalary').value = '';
    document.getElementById('adminMaxSalary').value = '';
    document.getElementById('adminMargin').value = '';
    document.getElementById('adminEditIndex').value = '';
  }

  function saveBankConfig(e) {
    e.preventDefault();
    const bankName = document.getElementById('adminBankName').value;
    const financeType = document.getElementById('adminFinanceType').value;
    const supportedType = document.getElementById('adminSupportedType').value;
    const minSalary = parseFloat(document.getElementById('adminMinSalary').value || '0');
    const maxSalary = parseFloat(document.getElementById('adminMaxSalary').value || '0');
    const margin = parseFloat(document.getElementById('adminMargin').value || '0');
    const editIndex = document.getElementById('adminEditIndex').value;

    if (!bankName || !margin || !minSalary || !maxSalary) {
      alert('Ø±Ø¬Ø§Ø¡Ù‹ Ø£ÙƒÙ…Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©.');
      return;
    }
    const cfg = { bankName, financeType, supportedType, minSalary, maxSalary, margin };

    if (editIndex === '') {
      bankConfigs.push(cfg);
    } else {
      bankConfigs[parseInt(editIndex)] = cfg;
    }
    saveBankConfigs();
    renderBankTable();
    clearAdminForm();
  }

  function editBankConfig(index) {
    const cfg = bankConfigs[index];
    document.getElementById('adminBankName').value = cfg.bankName;
    document.getElementById('adminFinanceType').value = cfg.financeType;
    document.getElementById('adminSupportedType').value = cfg.supportedType;
    document.getElementById('adminMinSalary').value = cfg.minSalary;
    document.getElementById('adminMaxSalary').value = cfg.maxSalary;
    document.getElementById('adminMargin').value = cfg.margin;
    document.getElementById('adminEditIndex').value = index;
  }

  function deleteBankConfig(index) {
    if (!confirm('Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø±ØŸ')) return;
    bankConfigs.splice(index, 1);
    saveBankConfigs();
    renderBankTable();
  }

  function getMatchingBanksForAnswers() {
    const salary = parseFloat(answers.salary || '0');
    if (!salary) return [];

    let fType;
    if (answers.financeType === 'Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ') {
      fType = 'buyoutPersonal';
    } else if (answers.financeType === 'Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ') {
      fType = 'buyoutMortgage';
    } else if (answers.financeType && answers.financeType.includes('Ø´Ø®ØµÙŠ')) {
      fType = 'personal';
    } else if (answers.financeType && answers.financeType.includes('Ø¹Ù‚Ø§Ø±ÙŠ')) {
      fType = 'mortgage';
    } else {
      fType = 'personal';
    }

    const supp = answers.supported || 'Ø§Ù„ÙƒÙ„';

    const list = bankConfigs.filter(cfg =>
      cfg.financeType === fType &&
      salary >= cfg.minSalary &&
      salary <= cfg.maxSalary &&
      (cfg.supportedType === 'Ø§Ù„ÙƒÙ„' || cfg.supportedType === supp)
    );
    list.sort((a,b)=> a.margin - b.margin);
    return list;
  }

  const ADMIN_PIN = '11qq11qQ@';

  function handleAdminLogin() {
    const pin = document.getElementById('adminPin').value;
    const err = document.getElementById('adminLoginError');
    if (pin === ADMIN_PIN) {
      err.style.display = 'none';
      showPage('admin');
    } else {
      err.style.display = 'block';
    }
  }

  let answers = { commitments: [] }, step = 0, commitmentStep = 0, currentCommitment = {};
  let hasStarted = false;

  const generalQuestions = [
    { id:'clientName',label:'Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…',type:'text' },
    { id:'birthDay',label:'Ø§Ø®ØªØ± ÙŠÙˆÙ… Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:',type:'select',options:Array.from({length:30},(_,i)=>i+1),default:1 },
    { id:'birthMonth',label:'Ø§Ø®ØªØ± Ø´Ù‡Ø± Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:',type:'select',options:Array.from({length:12},(_,i)=>i+1),default:1 },
    { id:'birthYear',label:'Ø§Ø®ØªØ± Ø³Ù†Ø© Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:',type:'select',options:Array.from({length:61},(_,i)=>1430 - i),default:1412 },
    { id:'jobType',label:'Ù†ÙˆØ¹ Ø§Ù„ÙˆØ¸ÙŠÙØ©',type:'select',options:['Ø¹Ø³ÙƒØ±ÙŠ','Ù…Ø¯Ù†ÙŠ (Ù‚Ø·Ø§Ø¹ Ø­ÙƒÙˆÙ…ÙŠ)','Ø®Ø§Øµ (Ø´Ø¨Ù‡ Ø­ÙƒÙˆÙ…ÙŠ)','Ø®Ø§Øµ (Ø´Ø±ÙƒØ© Ù…Ø¹ØªÙ…Ø¯Ø©)','Ø®Ø§Øµ (Ø´Ø±ÙƒØ© ØºÙŠØ± Ù…Ø¹ØªÙ…Ø¯Ø©)'] },
    { 
      id:'militaryRank',
      label:'Ø§Ø°ÙƒØ± Ø§Ù„Ø±ØªØ¨Ø© Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠØ©',
      type:'select',
      options:[
        'Ø¬Ù†Ø¯ÙŠ','Ø¬Ù†Ø¯ÙŠ Ø£ÙˆÙ„','Ø¹Ø±ÙŠÙ','ÙˆÙƒÙŠÙ„ Ø±Ù‚ÙŠØ¨','Ø±Ù‚ÙŠØ¨','Ø±Ù‚ÙŠØ¨ Ø£ÙˆÙ„',
        'Ø±Ø¦ÙŠØ³ Ø±Ù‚Ø¨Ø§Ø¡','Ù…Ù„Ø§Ø²Ù…','Ù…Ù„Ø§Ø²Ù… Ø£ÙˆÙ„','Ù†Ù‚ÙŠØ¨','Ø±Ø§Ø¦Ø¯','Ù…Ù‚Ø¯Ù…','Ø¹Ù‚ÙŠØ¯','Ø¹Ù…ÙŠØ¯','Ù„ÙˆØ§Ø¡'
      ],
      show:a=>a.jobType==='Ø¹Ø³ÙƒØ±ÙŠ'
    },
    { 
      id:'financeType',
      label:'Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ ØªØ±ÙŠØ¯ Ø­Ø³Ø¨ØªÙ‡:',
      type:'select',
      options:[
        'ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ Ø£Ùˆ ØªÙ…ÙˆÙŠÙ„ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ',
        'ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ',
        'Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ',
        'Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ'
      ]
    },
    { id:'supported',label:'Ù‡Ù„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ø¯Ø¹ÙˆÙ…ØŸ',type:'select',options:['Ù…Ø¯Ø¹ÙˆÙ…','ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…'],show:a=>a.financeType==='ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ' },
    { id:'bundle',label:'Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø© Ù…Ù† Ø³ÙƒÙ†ÙŠØŸ',type:'select',options:['Ù†Ø¹Ù…','Ù„Ø§'],show:a=>a.supported==='Ù…Ø¯Ø¹ÙˆÙ…' },
    { id:'salary',label:'ÙƒÙ… Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø§Ù„ØµØ§ÙÙŠØŸ',type:'number' },
    { id:'months',label:'Ø¹Ù„Ù‰ ÙƒÙ… Ø´Ù‡Ø± ØªØ±ÙŠØ¯ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ØŸ',type:'select',options:[],dynamic:true },
    { id:'calcMode',label:'ÙƒÙŠÙ ØªÙØ¶Ù‘Ù„ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù†Ø³Ø¨Ø©ØŸ',type:'select',options:['Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Ø³Ø¨Ø© Ø¨Ù†ÙØ³ÙŠ','ØªØ±Ø´ÙŠØ­ Ø¨Ù†Ùƒ Ù…Ù†Ø§Ø³Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹'] },
    { id:'profitMargin',label:'Ù†Ø³Ø¨Ø© Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø³Ù†ÙˆÙŠ (%)ØŸ',type:'number' },
    {
      id:'buyoutAmount',
      label:'ÙƒÙ… Ù…Ø¨Ù„Øº Ø§Ù„ØªØ³Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¨ÙƒØ± Ù„Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©)ØŸ',
      type:'number',
      show:a=>a.financeType==='Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ'
    },
    { id:'hasCommitments',label:'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø§Ù„ØªØ²Ø§Ù…Ø§ØªØŸ',type:'select',options:['Ù†Ø¹Ù…','Ù„Ø§'] }
  ];

  const commitmentQuestions = [
    { id:'type',label:'Ù†ÙˆØ¹ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…',type:'select',options:['Ù‚Ø±Ø¶ Ø´Ø®ØµÙŠ','Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©','Ù‚Ø±Ø¶ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ','Ù‚Ø±Ø¶ Ø¹Ù‚Ø§Ø±ÙŠ'] },
    { id:'amount',label:'ÙƒÙ… Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠØŸ',type:'number' },
    { id:'months',label:'ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©ØŸ',type:'select',options:[],dynamic:true },
    { id:'balloon',label:'Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ø¯ÙØ¹Ø© Ø£Ø®ÙŠØ±Ø© (Ù„Ù‚Ø±Ø¶ Ø§Ù„Ø³ÙŠØ§Ø±Ø©)ØŸ',type:'select',options:['Ù†Ø¹Ù…','Ù„Ø§'],show:c=>c.type==='Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©' },
    { id:'balloonAmount',label:'ÙƒÙ… Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø©ØŸ',type:'number',show:c=>c.balloon==='Ù†Ø¹Ù…' },
    { id:'more',label:'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø£Ø®Ø±Ù‰ØŸ',type:'select',options:['Ù†Ø¹Ù…','Ù„Ø§'] }
  ];

  function getRetirementAge(rank) {
    const retirementAges = {
      'Ø¬Ù†Ø¯ÙŠ': 44,
      'Ø¬Ù†Ø¯ÙŠ Ø£ÙˆÙ„': 44,
      'Ø¹Ø±ÙŠÙ': 46,
      'ÙˆÙƒÙŠÙ„ Ø±Ù‚ÙŠØ¨': 48,
      'Ø±Ù‚ÙŠØ¨': 50,
      'Ø±Ù‚ÙŠØ¨ Ø£ÙˆÙ„': 50,
      'Ø±Ø¦ÙŠØ³ Ø±Ù‚Ø¨Ø§Ø¡': 52,
      'Ù…Ù„Ø§Ø²Ù…': 44,
      'Ù…Ù„Ø§Ø²Ù… Ø£ÙˆÙ„': 44,
      'Ù†Ù‚ÙŠØ¨': 48,
      'Ø±Ø§Ø¦Ø¯': 50,
      'Ù…Ù‚Ø¯Ù…': 52,
      'Ø¹Ù‚ÙŠØ¯': 54,
      'Ø¹Ù…ÙŠØ¯': 56,
      'Ù„ÙˆØ§Ø¡': 58
    };
    return retirementAges[rank] || 60;
  }

  function getMaxAllowedMonths(){
    const year = parseInt(answers.birthYear);
    const age = 1446 - year;
    let maxAge = 60;

    if(answers.jobType === 'Ø¹Ø³ÙƒØ±ÙŠ'){
      maxAge = getRetirementAge(answers.militaryRank || 'Ø¬Ù†Ø¯ÙŠ');
    }

    const remainingYears = maxAge - age;
    const remainingMonths = remainingYears * 12;
    answers.retirementYearHijri = year + maxAge;

    if(remainingMonths <= 0){
      showSorryPage(answers.clientName || "Ø§Ù„Ø¹Ù…ÙŠÙ„");
      return 0;
    }
    const isPersonal = answers.financeType && (answers.financeType.includes('Ø´Ø®ØµÙŠ') || answers.financeType === 'Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ');
    return Math.min(remainingMonths, isPersonal ? 60 : 360);
  }

  function describeMonths(m){
    const y = Math.floor(m / 12), mo = m % 12;
    let result = `${m} Ø´Ù‡Ø±`;
    let yTxt = y === 1 ? "Ø³Ù†Ø© ÙˆØ§Ø­Ø¯Ø©" : y === 2 ? "Ø³Ù†ØªØ§Ù†" : y >= 3 && y <= 10 ? `${y} Ø³Ù†ÙˆØ§Øª` : y > 10 ? `${y} Ø³Ù†Ø©` : '';
    let mTxt = mo === 1 ? "ÙˆØ´Ù‡Ø± ÙˆØ§Ø­Ø¯" : mo === 2 ? "ÙˆØ´Ù‡Ø±ÙŠÙ†" : mo >= 3 && mo <= 10 ? `Ùˆ${mo} Ø£Ø´Ù‡Ø±` : mo > 10 ? `Ùˆ${mo} Ø´Ù‡Ø±` : '';
    if (yTxt || mTxt) result += ` (${yTxt} ${mTxt})`;
    return result.trim();
  }

  function numberToArabicWords(n){
    if (n < 1000) return `${n} Ø±ÙŠØ§Ù„`;
    let parts = [];
    if(n >= 1_000_000){
      let mil = Math.floor(n / 1_000_000);
      parts.push(mil === 1 ? "Ù…Ù„ÙŠÙˆÙ†" : mil === 2 ? "Ù…Ù„ÙŠÙˆÙ†Ø§Ù†" : mil <= 10 ? `${mil} Ù…Ù„Ø§ÙŠÙŠÙ†` : `${mil} Ù…Ù„ÙŠÙˆÙ†`);
      n %= 1_000_000;
    }
    if(n >= 1000){
      let th = Math.floor(n / 1000);
      parts.push(th === 1 ? "Ø£Ù„Ù" : th === 2 ? "Ø£Ù„ÙØ§Ù†" : th <= 10 ? `${th} Ø¢Ù„Ø§Ù` : `${th} Ø£Ù„Ù`);
      n %= 1000;
    }
    if(n > 0) parts.push(`${n}`);
    return parts.join(" Ùˆ ") + " Ø±ÙŠØ§Ù„";
  }

  function showSorryPage(name){
    showPage('calculator');
    const cont = document.getElementById('question');
    document.getElementById('nextButton').style.display = 'none';
    cont.innerHTML = `<div class="fade-in alert-error">
      <strong>Ù…Ø¹Ù„ÙŠØ´ ${name}ØŒ ÙŠØ¸Ù‡Ø± Ø¥Ù† Ø¹Ù…Ø±Ùƒ ØªØ¹Ø¯Ù‘Ù‰ Ø³Ù† Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ù„Ù„ØªÙ…ÙˆÙŠÙ„.</strong><br>
      Ø¥Ø°Ø§ ÙƒÙ†Øª Ù…ØªÙ‚Ø§Ø¹Ø¯ ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„ Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±.
    </div>`;
  }

  function handleStartOrReset(){
    if(!hasStarted){
      hasStarted = true;
      document.getElementById('mainButton').style.display = 'none';
      document.getElementById('resetButtonContainer').style.display = 'block';
      document.getElementById('nextButton').style.display = 'inline-flex';
      showQuestion();
    }else{ resetCalc(); }
  }

  function resetCalc(){
    answers = { commitments: [] };
    step = 0;
    commitmentStep = 0;
    currentCommitment = {};
    hasStarted = true;
    document.getElementById('mainButton').style.display = 'none';
    document.getElementById('resetButtonContainer').style.display = 'block';
    document.getElementById('nextButton').style.display = 'inline-flex';
    showQuestion();
  }

  function showQuestion(){
    const cont = document.getElementById('question');
    cont.innerHTML = '';
    let q;
    if(step < generalQuestions.length){
      q = generalQuestions[step];
      if(q.show && !q.show(answers)){ step++; showQuestion(); return; }

      if(q.id === 'salary' && answers.financeType === 'Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ'){
        showPage('comingSoon');
        return;
      }

      if(q.id === 'profitMargin' && answers.calcMode === 'ØªØ±Ø´ÙŠØ­ Ø¨Ù†Ùƒ Ù…Ù†Ø§Ø³Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹'){
        const list = getMatchingBanksForAnswers();
        const rec = list[0];
        if(rec){
          answers.recommendedBank = rec;
          answers.profitMargin = rec.margin;
          step++;
          showQuestion();
          return;
        } else {
          alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø§Ù„ÙŠØ§Ù‹ Ø¨Ù†Ùƒ Ù…Ø·Ø§Ø¨Ù‚ Ù„Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ØŒ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙŠ ØªØ¯Ø®Ù„Ù‡Ø§ ÙŠØ¯ÙˆÙŠØ§Ù‹.');
        }
      }
    }else if(answers.hasCommitments === 'Ù†Ø¹Ù…'){
      q = commitmentQuestions[commitmentStep];
      if(q.show && !q.show(currentCommitment)){ commitmentStep++; showQuestion(); return; }
    }else{
      document.getElementById('nextButton').style.display = 'none';
      calculate();
      return;
    }

    const div = document.createElement('div');
    div.classList.add('fade-in');
    div.innerHTML = `<label>${q.label}</label>`;
    if(q.type === 'select'){
      const sel = document.createElement('select');
      sel.id = q.id;
      sel.innerHTML = '<option value="">Ø§Ø®ØªØ±...</option>';
      if(q.dynamic && q.id === 'months'){
        const limit = (step < generalQuestions.length)
          ? getMaxAllowedMonths()
          : (currentCommitment.type === 'Ù‚Ø±Ø¶ Ø¹Ù‚Ø§Ø±ÙŠ' ? 360 : 60);
        for(let i=1; i<=limit; i++){
          sel.innerHTML += `<option value="${i}">${i} Ø´Ù‡Ø±</option>`;
        }
      } else {
        q.options.forEach(opt => {
          sel.innerHTML += `<option value="${opt}">${opt}</option>`;
        });
      }
      div.appendChild(sel);
    } else {
      div.innerHTML += `<input type="${q.type}" id="${q.id}" ${q.default ? `value="${q.default}"` : ''}>`;
    }

    cont.appendChild(div);
  }

  function nextQuestion(){
    const q = step < generalQuestions.length ? generalQuestions[step] : commitmentQuestions[commitmentStep];
    const el = document.getElementById(q.id);
    const val = el ? el.value : '';

    if(!val){
      alert('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚Ù„ Ù‚Ø¨Ù„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©');
      return;
    }

    if(step < generalQuestions.length){
      answers[q.id] = val;

      if(q.id === 'financeType' && val === 'Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ'){
        showPage('comingSoon');
        return;
      }

      if(q.id === 'months'){
        const max = getMaxAllowedMonths();
        if(parseInt(val) > max){
          alert(`Ø£Ù‚ØµÙ‰ Ù…Ø¯Ø© Ù…Ø³Ù…ÙˆØ­Ø© Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù…Ø± ÙˆØ§Ù„ØªÙ‚Ø§Ø¹Ø¯: ${describeMonths(max)}.`);
          answers[q.id] = max.toString();
        }
      }
      step++;
    }else{
      if(q.id === 'months') currentCommitment[q.id] = parseInt(val);
      else if(q.id === 'amount' || q.id === 'balloonAmount') currentCommitment[q.id] = parseFloat(val);
      else currentCommitment[q.id] = val;

      if(q.id === 'more'){
        answers.commitments.push(currentCommitment);
        currentCommitment = {};
        if(val === 'Ù†Ø¹Ù…'){
          commitmentStep = 0;
          showQuestion();
          return;
        }else{
          document.getElementById('nextButton').style.display = 'none';
          calculate();
          return;
        }
      }
      commitmentStep++;
    }
    showQuestion();
  }

  function calculate(){
    const salary = parseFloat(answers.salary),
          months = parseInt(answers.months),
          years  = months / 12,
          { financeType, supported, bundle } = answers;

    let profitMargin = parseFloat(answers.profitMargin);
    if (!profitMargin || isNaN(profitMargin)) {
      alert('Ù†Ø³Ø¨Ø© Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ ØºÙŠØ± ØµØ­ÙŠØ­Ø©.');
      return;
    }

    const isBuyoutPersonal = financeType === 'Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ';
    const isPersonalLike = (financeType && financeType.includes('Ø´Ø®ØµÙŠ')) || isBuyoutPersonal;

    let deductionRate = 0, extraSupport = 0, addCommodityFee = false;
    if(isPersonalLike){
      if(months > 60){ alert('Ù…Ø¯Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠ Ù„Ø§ ØªØªØ¬Ø§ÙˆØ² 60 Ø´Ù‡Ø±'); return; }
      deductionRate = 45;
      addCommodityFee = true;
    }else{
      if(supported === 'Ù…Ø¯Ø¹ÙˆÙ…'){
        if(bundle === 'Ù„Ø§'){
          deductionRate = 65;
          extraSupport = salary < 10000 ? 150000 : 100000;
        } else {
          deductionRate = salary < 15000 ? 55 : 65;
        }
      }else{
        deductionRate = salary < 15000 ? 55 : 65;
      }
    }

    let allowedInst = salary * deductionRate / 100;
    let commits = [...answers.commitments].sort((a,b)=>parseInt(a.months)-parseInt(b.months));
    let balloonPhases = [];

    commits.forEach((c) => {
      if (c.type === 'Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©' && c.balloon === 'Ù†Ø¹Ù…' && c.balloonAmount) {
        const start = parseInt(c.months);
        const end = start + 24;
        balloonPhases.push({ start, end, value: c.balloonAmount / 24 });
      }
    });

    let futurePhases = [];
    for(let m = 1; m <= months; m++) {
      let activeCommits = commits
        .filter(c => m <= parseInt(c.months))
        .reduce((sum, c) => sum + (c.amount || 0), 0);
      let balloonExtra = balloonPhases.reduce((sum, b) =>
        (m >= b.start && m < b.end) ? sum + b.value : sum, 0);
      let available = allowedInst - activeCommits - balloonExtra;
      if(isPersonalLike){
        available = Math.min(available, salary * 0.3333);
      }
      futurePhases.push({ month: m, inst: available });
    }

    let finalPhases = [];
    for (let i = 0; i < futurePhases.length; i++) {
      if (i === 0 || futurePhases[i].inst !== finalPhases[finalPhases.length - 1]?.inst) {
        finalPhases.push({ from: futurePhases[i].month, to: futurePhases[i].month, inst: futurePhases[i].inst });
      } else {
        finalPhases[finalPhases.length - 1].to = futurePhases[i].month;
      }
    }

    const totalInst = finalPhases.reduce((s,p)=>s + p.inst * (p.to - p.from + 1), 0);
    const profitFactor = (years * profitMargin / 100) + 1;
    const netFinance = totalInst / profitFactor;

    let adminFee = 0, vat = 0;
    if (isPersonalLike) {
      adminFee = netFinance * 0.005;
      if (adminFee > 2500) adminFee = 2500;
      vat = adminFee * 0.15;
    } else {
      adminFee = netFinance * 0.01;
      vat = adminFee * 0.15;
      if(adminFee + vat > 5750){ adminFee = 5000; vat = 750; }
    }

    const commodityFee = addCommodityFee ? netFinance * 0.01 : 0;

    const netWithoutFees = netFinance;
    const netAfterAdmin = netFinance - (adminFee + vat);
    const finalNet = netAfterAdmin - commodityFee;
    const totalProfitWithFees = totalInst - finalNet;

    let supportText = '';
    if(financeType === 'ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ' && supported === 'Ù…Ø¯Ø¹ÙˆÙ…'){
      const sup = salary < 10000 ? 150000 : 100000;
      if(bundle === 'Ù†Ø¹Ù…'){
        supportText = `<div class="result-amount-small" style="color:#1d4ed8;">Ø¯Ø¹Ù… Ø­ÙƒÙˆÙ…ÙŠ Ù…Ø¶Ø§Ù ØªÙ‚Ø¯ÙŠØ±ÙŠØ§Ù‹: ${sup.toLocaleString()} Ø±ÙŠØ§Ù„</div>`;
      }else{
        const dist = Math.min(months, 240),
              monthly = Math.round(sup / dist);
        supportText = `<div class="result-amount-small" style="color:#1d4ed8;">ØªÙ… ØªÙˆØ²ÙŠØ¹ Ø¯Ø¹Ù… ${sup.toLocaleString()} Ø±ÙŠØ§Ù„ Ø¹Ù„Ù‰ ${dist} Ø´Ù‡Ø± â‰ˆ ${monthly.toLocaleString()} Ø±ÙŠØ§Ù„ Ø´Ù‡Ø±ÙŠØ§Ù‹</div>`;
      }
    }

    const name = answers.clientName || "Ø§Ù„Ø¹Ù…ÙŠÙ„";
    const duration = describeMonths(months);
    const finalNetFixed = finalNet.toFixed(0);
    const netAfterAdminFixed = netAfterAdmin.toFixed(0);
    const netWithoutFeesFixed = netWithoutFees.toFixed(0);

    const allNegative = finalPhases.every(p => p.inst <= 0);

    const buyoutAmount = isBuyoutPersonal
      ? parseFloat(answers.buyoutAmount || '0')
      : 0;
    const netAfterBuyout = finalNet - buyoutAmount;

    const matchingBanks = getMatchingBanksForAnswers();
    const recommendedBank = matchingBanks[0] || null;
    const altBanks = matchingBanks.slice(1, 4);

    answers.recommendedBank = answers.recommendedBank || recommendedBank;

    showPage('result');
    const resultCard = document.getElementById('resultCard');
    let html = '';

    html += `<h2 style="margin:0 0 6px; font-size:18px; text-align:right; color:#111827;">
      Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø³Ø¨Ø© (Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ©)
    </h2>`;

    html += `<div class="result-header">
      <div class="client-chip">Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙˆÙ…Ø³Ù‡Ù„Ø§ ÙŠØ§ ${name}</div>
      <div style="text-align:right;">
        <span class="badge-mode">
          ${answers.calcMode === 'ØªØ±Ø´ÙŠØ­ Ø¨Ù†Ùƒ Ù…Ù†Ø§Ø³Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹' ? 'Ø§Ù„Ø­Ø³Ø¨Ø© Ù…Ø¹ ØªØ±Ø´ÙŠØ­ Ø¨Ù†Ùƒ Ù…Ù†Ø§Ø³Ø¨' : 'Ø§Ù„Ø­Ø³Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¯Ø®Ù„Ø©'}
        </span><br>
        <span class="badge-duration">Ù…Ø¯Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„: ${duration}</span>
      </div>
    </div>`;

    if (recommendedBank) {
      const b = recommendedBank;
      const logoSrc = bankLogoMap[b.bankName];
      html += `<div class="bank-card">
        <div class="bank-logo">
          ${logoSrc ? `<img src="${logoSrc}" alt="${b.bankName}">` : 'ğŸ¦'}
        </div>
        <div style="text-align:right">
          <div class="bank-text-main">${b.bankName}</div>
          <div class="bank-text-sub">
            ØªÙ… ØªØ±Ø´ÙŠØ­ Ù‡Ø°Ø§ Ø§Ù„Ø¨Ù†Ùƒ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø±Ø§ØªØ¨Ùƒ ÙˆÙ†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø¨Ù†Ø³Ø¨Ø© Ù‡Ø§Ù…Ø´ Ø±Ø¨Ø­ ØªÙ‚Ø±ÙŠØ¨ÙŠØ©:
            <strong>${b.margin}%</strong>
          </div>
        </div>
      </div>`;
    }

    if (allNegative) {
      html += `<div class="alert-error">
        Ù†Ø¹ØªØ°Ø± Ù…Ù†ÙƒØŒ Ø­Ø³Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø© Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù‚Ø³Ø· Ù…ØªØ§Ø­ Ù„Ù„ØªÙ…ÙˆÙŠÙ„ Ø­Ø§Ù„ÙŠØ§Ù‹.
      </div>`;
    }

    html += `
      <div class="result-main-block">
        <div class="result-main-title"> </div>
        <div class="result-amount-main">
          ${finalNetFixed.replace(/\B(?=(\d{3})+(?!\d))/g, ",")} Ø±ÙŠØ§Ù„
        </div>
        <div class="result-amount-sub">
          Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ Ø¨Ø¹Ø¯ Ø®ØµÙ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© ÙˆØ§Ù„Ø¶Ø±ÙŠØ¨Ø© ${addCommodityFee ? 'ÙˆØ±Ø³ÙˆÙ… Ø§Ù„Ø³Ù„Ø¹' : ''}.
        </div>
        <div class="dual-main-grid">
          <div class="dual-box">
            <div class="dual-box-title">Ø§Ù„ØµØ§ÙÙŠ Ù‚Ø¨Ù„ Ø£ÙŠ Ø±Ø³ÙˆÙ…</div>
            <div class="dual-box-amount">
              ${netWithoutFeesFixed.replace(/\B(?=(\d{3})+(?!\d))/g, ",")} Ø±.Ø³
            </div>
          </div>
          <div class="dual-box">
            <div class="dual-box-title">Ø¨Ø¹Ø¯ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© + Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© ÙÙ‚Ø·</div>
            <div class="dual-box-amount">
              ${netAfterAdminFixed.replace(/\B(?=(\d{3})+(?!\d))/g, ",")} Ø±.Ø³
            </div>
          </div>
        </div>
        ${isBuyoutPersonal && buyoutAmount > 0 ? `
          <div class="dual-box" style="margin-top:6px;">
            <div class="dual-box-title">ÙƒÙ… ÙŠØµÙÙŠ Ù„Ùƒ Ø¨Ø¹Ø¯ Ø³Ø¯Ø§Ø¯ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ù‚Ø¯ÙŠÙ…</div>
            <div class="dual-box-amount">
              ${netAfterBuyout.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} Ø±.Ø³
            </div>
          </div>
        ` : ''}
        ${supportText}
        <div style="margin-top:6px; font-size:13px; color:#374151;">
          Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ Ù…ÙƒØªÙˆØ¨ Ø¨Ø§Ù„Ø­Ø±ÙˆÙ Ù„ØªÙˆØ¶ÙŠØ­ Ø§Ù„Ø±Ù‚Ù…:
          <strong>${numberToArabicWords(parseInt(finalNetFixed))}</strong>
        </div>
        <div class="result-amount-small" style="margin-top:4px;">
          Ù†Ø³Ø¨Ø© Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù…Ø­ØªØ³Ø¨Ø©: <strong>${profitMargin}% Ø³Ù†ÙˆÙŠØ§Ù‹</strong>
        </div>
      </div>
    `;

    if (isBuyoutPersonal && buyoutAmount > 0) {
      html += `
        <div class="result-section-title">ØªÙØ§ØµÙŠÙ„ Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠ</div>
        <div class="result-section-box">
          <div class="instalment-row">
            Ù…Ø¨Ù„Øº Ø§Ù„ØªØ³Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¨ÙƒØ± (Ø³Ø¯Ø§Ø¯ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ):
            <strong>${buyoutAmount.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} Ø±ÙŠØ§Ù„</strong>
          </div>
          <div class="instalment-row">
            Ø§Ù„ØµØ§ÙÙŠ Ù„Ùƒ Ø¨Ø¹Ø¯ Ø®ØµÙ… Ù…Ø¨Ù„Øº Ø§Ù„ØªØ³Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¨ÙƒØ±:
            <strong>${netAfterBuyout.toFixed(0).replace(/\B(?=(\d{5})+(?!\d))/g, ",")} Ø±ÙŠØ§Ù„</strong>
          </div>
          ${netAfterBuyout < 5000 ? `
            <div class="alert-error" style="margin-top:6px;">
              ØªÙ†Ø¨ÙŠÙ‡: Ø§Ù„ØµØ§ÙÙŠ Ø£Ù‚Ù„ Ù…Ù† 5,000 Ø±ÙŠØ§Ù„ØŒ Ù‚Ø¯ ÙŠØ¹ØªØ°Ø± Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø´ØªØ±ÙŠ Ø¹Ù† Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨ØŒ Ù†Ø±Ø¬Ùˆ Ø§Ù„Ø§Ù†ØªØ¨Ø§Ù‡.
            </div>
          ` : ''}
        </div>
      `;
    }

    html += `
      <div class="result-section-title">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ Ø­Ø³Ø¨ Ø§Ù„ÙØªØ±Ø§Øª</div>
      <div class="result-section-box">
    `;
    finalPhases.forEach(p=>{
      html += `
        <div class="instalment-row">
          Ø§Ù„Ù‚Ø³Ø· Ù…Ù† Ø§Ù„Ø´Ù‡Ø± <strong>${p.from}</strong> Ø¥Ù„Ù‰ <strong>${p.to}</strong>:
          <strong>${p.inst.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} Ø±ÙŠØ§Ù„</strong>
        </div>
      `;
    });
    html += `</div>`;

    if (altBanks.length > 0) {
      html += `
        <div class="result-section-title">Ù£ Ø¨Ù†ÙˆÙƒ Ø£Ø®Ø±Ù‰ Ù…Ù†Ø§ÙØ³Ø© (Ù…Ù† Ø§Ù„Ø£Ù‚Ù„ Ù†Ø³Ø¨Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø¹Ù„Ù‰)</div>
        <div class="result-section-box">
          <ul style="margin:0; padding-right:16px; font-size:13px; color:#4b5563; list-style-type:disc; text-align:right;">
      `;
      altBanks.forEach(b => {
        html += `<li>${b.bankName} - Ù†Ø³Ø¨Ø© Ù‡Ø§Ù…Ø´ Ø±Ø¨Ø­ ØªÙ‚Ø±ÙŠØ¨ÙŠØ©: <strong>${b.margin}%</strong></li>`;
      });
      html += `</ul></div>`;
    }

    html += `
      <div class="result-section-title">Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø±Ø³ÙˆÙ…</div>
      <div class="result-section-box">
        <div class="instalment-row">
          Ø§Ù„Ø±Ø¨Ø­ Ø¯ÙˆÙ† Ø§Ù„Ø±Ø³ÙˆÙ…:
          <strong>${(totalInst - netWithoutFees).toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} Ø±ÙŠØ§Ù„</strong>
        </div>
        <div class="instalment-row">
          Ø§Ù„Ø±Ø¨Ø­ Ù…Ø¹ Ø§Ù„Ø±Ø³ÙˆÙ…:
          <strong>${totalProfitWithFees.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} Ø±ÙŠØ§Ù„</strong>
        </div>
        <div class="instalment-row">
          Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©:
          <strong>${adminFee.toFixed(0)} Ø±ÙŠØ§Ù„</strong>  
          + Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©:
          <strong>${vat.toFixed(0)} Ø±ÙŠØ§Ù„</strong>
          ${addCommodityFee ? ` + Ø±Ø³ÙˆÙ… Ø§Ù„Ø³Ù„Ø¹: <strong>${commodityFee.toFixed(0)} Ø±ÙŠØ§Ù„</strong>` : ''}
        </div>
        <div class="instalment-row">
          Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ø¹ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ (Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©):
          <strong>${totalInst.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} Ø±ÙŠØ§Ù„</strong>
        </div>
      </div>
      <div style="margin-top:10px; font-size:13px; color:#6b7280; text-align:right;">
        âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø³Ø¨Ø© ØªÙ‚Ø±ÙŠØ¨ÙŠØ© ÙˆÙ„ÙŠØ³Øª Ø¹Ø±Ø¶Ø§Ù‹ Ù…Ù„Ø²Ù…Ø§Ù‹ØŒ ÙˆØ§Ù„Ù†Ø³Ø¨ Ø§Ù„ÙØ¹Ù„ÙŠØ© ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø¨Ù†Ùƒ ÙˆÙ‚Øª ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨.
      </div>
      <div style="margin-top:8px; font-size:14px; font-weight:bold; color:#1e3a8a; text-align:center;">
        ğŸ“¸ ØªÙ‚Ø¯Ø± ØªØµÙˆÙ‘Ø± Ø§Ù„Ø´Ø§Ø´Ø© Ø£Ùˆ ØªØ³ØªØ®Ø¯Ù… Ø²Ø± Â«Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙƒØµÙˆØ±Ø©Â»   
      </div>
    `;

    resultCard.innerHTML = html;
  }

  // Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙƒØµÙˆØ±Ø©
  function saveResultAsImage() {
    const card = document.getElementById('resultCard');
    if (!card) {
      alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø©.');
      return;
    }
    html2canvas(card, {
      scale: 2
    }).then(canvas => {
      const link = document.createElement('a');
      link.download = 'fino-result.png';
      link.href = canvas.toDataURL('image/png');
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }).catch(err => {
      console.error(err);
      alert('ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙƒØµÙˆØ±Ø©ØŒ Ø¬Ø±Ù‘Ø¨ Ù…Ù† Ù…ØªØµÙØ­ Ø¢Ø®Ø± Ø£Ùˆ ØªØ£ÙƒØ¯ Ø£Ù† Ø¬Ø§ÙØ§Ø³ÙƒØ±Ø¨Øª Ù…ÙØ¹Ù‘Ù„.');
    });
  }

  function updateDateTime(){
    const n = new Date();
    const y = n.getFullYear();
    const m = String(n.getMonth()+1).padStart(2,'0');
    const d = String(n.getDate()).padStart(2,'0');
    const hh = String(n.getHours()).padStart(2,'0');
    const mm = String(n.getMinutes()).padStart(2,'0');
    const ss = String(n.getSeconds()).padStart(2,'0');
    const el = document.getElementById('datetime');
    if (el) {
      el.textContent = `${y}-${m}-${d} ${hh}:${mm}:${ss}`;
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    showPage('landing');
    loadBankConfigs();
    updateDateTime();
    setInterval(updateDateTime, 1000);
  });
</script>

</body>
</html>